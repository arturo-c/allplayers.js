(function(b){b.fn.treeselect=function(d){var d=b.extend({colwidth:18,selected:null,load:null,deepLoad:!1},d),c=function(a){b.extend(this,{id:0,title:"",has_children:!1,children:[],level:0,odd:!1,checked:!1,busy:!1,display:b(),input:b(),link:b(),span:b(),childlist:b()},a)};c.prototype.setBusy=function(a){if(this.busy=a){a=b(document.createElement("div")).addClass("treebusy");a.text("loading...");var g=b("ul",this.display);0==g.length?this.display.append(a):g.prepend(a)}else b("div.treebusy",this.display).remove()};
c.prototype.loadAll=function(a){if(d.load){var b=this.children.length,c=b;if(0===b)this.has_children?d.load(this,function(b){b.build();b.loadAll(a)}):a&&a(this);else for(;b--;)this.children[b].loadAll(function(b){return function(){c--;!c&&a&&a(b)}}(this))}};c.prototype.loadChildren=function(){d.load&&(this.setBusy(!0),d.load(this,function(a){a.build();a.expand(!0)}))};c.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),
this.childlist.show("fast")):(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),this.childlist.hide("fast"));a&&0==this.children.length&&this.has_children&&this.loadChildren()};c.prototype.select=function(a,b){this.checked=a;this.input.attr("checked",a);for(var c=this.children.length;c--;)this.children[c].select(a,!0);d.selected&&d.selected(this,!b)};c.prototype.build_list=function(){var a=b();this.id&&(a=b(document.createElement("li")),
a.addClass(this.odd?"odd":"even"));return a};c.prototype.build_input=function(a){this.id&&(this.input=b(document.createElement("input")),this.input.attr({type:"checkbox",value:this.id,name:"treeselect-"+this.id,checked:this.checked}),this.input.css("left",a+"px"),this.input.bind("click",function(a){return function(c){var e=b(c.target).is(":checked");e&&a.expand(!0);e&&d.deepLoad?(a.setBusy(!0),a.loadAll(function(){a.setBusy(!1);a.select(e)})):a.select(e)}}(this)));return this.input};c.prototype.build_link=
function(a){a.css("cursor","pointer").addClass("collapsed");a.bind("click",{node:this},function(a){a.preventDefault();a.data.node.expand(b(a.target).hasClass("collapsed"))});return a};c.prototype.build_span=function(a){if(this.id&&(0<this.children.length||this.has_children))this.span=this.build_link(b(document.createElement("span"))),this.span.css("left",a+"px");return this.span};c.prototype.build_title=function(a){this.id&&this.title&&(this.link=this.build_link(b(document.createElement("a"))),this.link.css("marginLeft",
a+"px").text(this.title));return this.link};c.prototype.build_children=function(){this.childlist=b();if(0<this.children.length){this.childlist=b(document.createElement("ul"));var a=this.odd,d;for(d in this.children)this.children.hasOwnProperty(d)&&(a=!a,this.children[d]=new c(b.extend(this.children[d],{level:this.level+1,odd:a,checked:this.checked})),this.childlist.append(this.children[d].build()))}return this.childlist};c.prototype.build=function(){if(!this.id&&0==this.children.length)this.loadChildren();
else{var a=0;0==this.display.length&&(this.display=this.build_list());0==this.input.length&&this.display.append(this.build_input(a));0==this.span.length&&(a+=d.colwidth,this.display.append(this.build_span(a)));0==this.link.length&&(a+=d.colwidth,this.display.append(this.build_title(a)));0==this.childlist.length&&this.display.append(this.build_children());this.checked&&this.select(this.checked);this.busy&&this.setBusy(!1)}return this.display};return b(this).each(function(){(new c(b.extend(d,{display:b(this)}))).build()})}})(jQuery);
(function(b){b.fn.chosentree=function(d){d=b.extend({width:350,default_text:"Select Item",selected:null},d);return b(this).each(function(){function c(a){a?f.addClass("treevisible").show("fast"):f.removeClass("treevisible").hide("fast")}var a=null,g=null,h=null,e=null,f=e=null,a=b(document.createElement("div"));a.addClass("chzn-container chzn-container-multi");g=b(document.createElement("ul"));g.addClass("chzn-choices chosentree-choices");g.css("width",d.width+"px");h=b(document.createElement("li"));
h.addClass("search-field");e=b(document.createElement("input"));e.attr({type:"text",value:d.default_text,"class":"default",autocomplete:"off"});e.css("width","100%");e.focus(function(){c(!0)});a.append(g.append(h.append(e)));f=b(document.createElement("div"));f.addClass("treewrapper");f.css("width",d.width+"px");f.hide();e=b(document.createElement("div"));e.addClass("treeselect");b(this).keyup(function(a){27==a.which&&c(!1)});b(this).append(a.append(f.append(e)));a=d;a.selected=function(a,d){if(a.checked){var c=
b(document.createElement("li"));c.addClass("search-choice");c.attr("id","choice_"+a.id);var e=b(document.createElement("span"));e.text(a.title);var f=b(document.createElement("a"));f.addClass("search-choice-close");f.attr("href","javascript:void(0)");f.bind("click",function(c){c.preventDefault();b("li#choice_"+a.id,g).remove();a.select(!1)});h.before(c.append(e).append(f))}else b("li#choice_"+a.id,g).remove();d&&jQuery.fn.moreorless&&(c=b("li.search-choice",g).length,g.moreorless(100,"+"+c+" more"))};
b(e).treeselect(a)})}})(jQuery);
