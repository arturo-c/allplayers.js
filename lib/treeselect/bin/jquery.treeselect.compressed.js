(function(b){b.fn.treeselect=function(d){var d=b.extend({colwidth:18,default_value:{},selected:null,treeloaded:null,load:null,deepLoad:!1,onbuild:null,inputName:"treeselect",selectAll:!1,selectAllText:"Select All"},d),e={},c=function(a,g){this.root=!!g;a.title=a.title||"anonymous";b.extend(this,{id:0,nodeloaded:!1,allLoaded:!1,value:0,title:"",has_children:!0,children:[],data:{},level:0,odd:!1,checked:!1,busy:!1,display:b(),input:b(),link:b(),span:b(),childlist:b()},a);this.isTreeNode=!0};c.prototype.setBusy=
function(a){a!=this.span.hasClass("treebusy")&&((this.busy=a)?this.span.addClass("treebusy"):this.span.removeClass("treebusy"))};c.prototype.isLoaded=function(){var a=this.nodeloaded,a=a|e.hasOwnProperty(this.id),a=a|!this.has_children;return a|=this.has_children&&0<this.children.length};c.prototype.loadNode=function(a,g){d.load&&!this.isLoaded()?(g||this.setBusy(!0),d.load(this,function(b){b.nodeloaded=!0;e[b.id]=b.id;b.build();a&&a(b);g||b.setBusy(!1)})):a&&a(this)};c.prototype.loadAll=function(a,
b,d){this.loadNode(function(c){b&&b(c);var e=c.children.length,i=e;if(e)for(d||c.setBusy(!0);e--;)c.children[e].loadAll(function(){i--;i||(a&&a(c),d||c.setBusy(!1))},b,d);else a&&a(c)})};c.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),this.childlist.show("fast")):0<this.span.length&&(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),
this.childlist.hide("fast"));a&&!this.isLoaded()&&this.loadNode(function(a){a.checked&&a.select(a.checked);a.expand(true)})};c.prototype.selectChildren=function(a){for(var b=this.children.length;b--;)this.children[b].select(a,!0)};c.prototype.check=function(a){this.checked=a;this.input.attr("checked",a);d.selected&&d.selected(this,!0)};c.prototype.select=function(a,b){this.checked=a;this.input.attr("checked",a);this.checked&&d.deepLoad?this.loadAll(function(c){c.selectChildren(a);d.selected&&d.selected(c,
!b)}):(this.selectChildren(a),d.selected&&d.selected(this,!b))};c.prototype.build_list=function(){var a=b(),a=b(document.createElement("li"));a.addClass(this.odd?"odd":"even");return a};c.prototype.build_input=function(a){if(d.inputName){this.input=b(document.createElement("input"));var c=this.value||this.id;this.input.attr({type:"checkbox",value:c,name:d.inputName+"-"+c,checked:this.checked});this.input.css("left",a+"px");this.input.bind("click",function(a){return function(c){c=b(c.target).is(":checked");
a.expand(c);a.select(c)}}(this));this.root&&this.input.hide()}return this.input};c.prototype.build_link=function(a){a.css("cursor","pointer").addClass("collapsed");a.bind("click",{node:this},function(a){a.preventDefault();a.data.node.expand(b(a.target).hasClass("collapsed"))});return a};c.prototype.build_span=function(a){!this.root&&this.has_children&&(this.span=this.build_link(b(document.createElement("span")).attr({"class":"treeselect-expand"})),this.span.css("left",a+"px"));return this.span};c.prototype.build_title=
function(a){!this.root&&this.title&&(this.link=this.build_link(b(document.createElement("a")).attr({"class":"treeselect-title"})),this.link.css("marginLeft",a+"px").text(this.title));return this.link};c.prototype.build_children=function(){this.childlist=b();if(0<this.children.length){this.childlist=b(document.createElement("ul"));var a=this.odd,d;for(d in this.children)this.children.hasOwnProperty(d)&&(a=!a,this.children[d]=new c(b.extend(this.children[d],{level:this.level+1,odd:a,checked:this.checked})),
this.childlist.append(this.children[d].build()))}return this.childlist};c.prototype.build=function(){var a=5,b=null;0==this.display.length&&(this.display=this.build_list());if(0==this.input.length&&(b=this.build_input(a))&&0<b.length)this.display.append(b),a+=d.colwidth;0==this.span.length&&(this.display.append(this.build_span(a)),a+=d.colwidth);0==this.link.length&&this.display.append(this.build_title(a));0==this.childlist.length&&this.display.append(this.build_children());if(d.onbuild)d.onbuild(this);
return this.display};c.prototype.getSelectAll=function(){return this.root&&this.selectAll?this.selectAllText:!1};c.prototype.setDefault=function(a,b){jQuery.isEmptyObject(a)?b&&b(this):this.loadAll(function(a){b&&b(a)},function(b){(a.hasOwnProperty(b.value)||a.hasOwnProperty(b.id))&&b.check(!0)})};c.prototype.search=function(a,b){var c={},a=a.toLowerCase();this.loadAll(function(){b&&b(c)},function(b){-1!==b.title.toLowerCase().search(a)&&(c[b.id]=b)},!0)};return b(this).each(function(){var a=b.extend(d,
{display:b(this)}),a=this.treenode=new c(a,!0),e=a.getSelectAll();!1!==e&&(a.display.append(b(document.createElement("input")).attr({type:"checkbox"}).bind("click",function(a){return function(c){a.selectChildren(b(c.target).is(":checked"));d.selected&&d.selected(a,!0)}}(a))),e&&(e=b(document.createElement("span")).html(e),a.display.append(e)));a.loadNode(function(a){a.children.length==0&&a.display.hide();a.checked&&a.select(a.checked);a.expand(true);a.setDefault(d.default_value,function(a){d.treeloaded&&
d.treeloaded(a)})})})}})(jQuery);
(function(b){b.fn.chosentree=function(d){d=b.extend({inputId:"chosentree-select",width:450,label:"",description:"",input_placeholder:"Select Item",input_type:"text",min_height:100,more_text:"+%num% more",loaded:null,collapsed:!0,showtree:!1},d);return b(this).each(function(){var e=null,c=null,a=null,g=null,h=null,k=null,p=null,i=null,n=null,f=null,o=function(a){a?f.addClass("treevisible").show("fast"):f.removeClass("treevisible").hide("fast")},e=b(document.createElement("div"));e.addClass("chosentree-selector chzn-container");
"search"==d.input_type?(e.addClass("chzn-container-single"),a=b(document.createElement("div")),a.addClass("chzn-search")):(e.addClass("chzn-container-multi"),c=b(document.createElement("ul")),c.addClass("chzn-choices chosentree-choices"),a=b(document.createElement("li")),a.addClass("search-field"));g=b(document.createElement("div"));g.addClass("chosentree-search-results");g.hide();k=b(document.createElement("label"));k.attr({"for":d.inputId});k.text(d.label);i=b(document.createElement("div"));i.attr({"class":"description"});
i.text(d.description);d.input_placeholder&&(h=b(document.createElement("input")),h.attr({type:"text",placeholder:d.input_placeholder,autocomplete:"off"}),!d.showtree&&d.collapsed&&h.focus(function(){o(true)}),"search"==d.input_type?(h.width(d.width-19),h.addClass("chosentree-search"),h.bind("input",function(){var a=b(this).val();if(a){var c=n.eq(0)[0].treenode;c&&c.search(a,function(a){console.log(a)})}})):(h.width(d.width),h.addClass("chosentree-results")),a.append(h));c?e.append(k).append(c.append(a)):
e.append(k).append(a);f=b(document.createElement("div"));f.addClass("treewrapper");f.css("width",d.width+"px");f.hide();p=b(document.createElement("span")).attr({"class":"tree-loading treebusy"}).css("display","block");n=b(document.createElement("div"));n.addClass("treeselect");b(this).keyup(function(a){a.which==27&&o(false)});f.append(g);f.append(n.append(p));b(this).append(e.append(f));b(this).append(i);var l=d;l.selected=function(e){return function(j,g){var f=b("li#choice_"+j.id,c);if(j.id)if(j.checked&&
f.length==0){f=b(document.createElement("li"));f.addClass("search-choice");f.attr("id","choice_"+j.id);f.eq(0)[0].nodeData=j;var i=b(document.createElement("span"));i.text(j.title);if(!g){var m=b(document.createElement("a"));m.addClass("search-choice-close");m.attr("href","javascript:void(0)");m.bind("click",function(a){a.preventDefault();b("li#choice_"+j.id,c).remove();j.select(false)})}a.before(f.append(i).append(m))}else j.checked||f.remove();if(g){var k=[];e.value={};c.show();h&&j.children.length==
0&&h.attr({value:""});b("li.search-choice",c).each(function(){e.value[this.nodeData.id]=this.nodeData.value;k.push(this.nodeData)});if(jQuery.fn.moreorless){m=d.more_text.replace("%num%",k.length);c.moreorless(d.min_height,m);c.div_expanded||o(true,null)}l.loaded&&l.loaded(k);b(e).trigger("treeloaded")}}}(this);l.treeloaded=function(){p.remove()};n.treeselect(l);c&&!l.collapsed&&c.hide();(l.showtree||!l.collapsed)&&o(!0,null)})}})(jQuery);
