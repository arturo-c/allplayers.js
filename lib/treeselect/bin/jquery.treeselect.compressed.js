(function(c){c.fn.treeselect=function(d){var d=c.extend({colwidth:18,default_value:{},selected:null,load:null,deepLoad:!1,onbuild:null,inputName:"treeselect",selectAll:!1,selectAllText:"Select All"},d),h={},e=function(a,b){this.root=!!b;a.title=a.title||"anonymous";c.extend(this,{id:0,loaded:!1,value:0,title:"",has_children:!0,children:[],data:{},level:0,odd:!1,checked:!1,busy:!1,display:c(),input:c(),link:c(),span:c(),childlist:c()},a);this.isTreeNode=!0};e.prototype.setBusy=function(a){a!=this.span.hasClass("treebusy")&&
((this.busy=a)?this.span.addClass("treebusy"):this.span.removeClass("treebusy"))};e.prototype.isLoaded=function(){var a=this.loaded,a=a|h.hasOwnProperty(this.id),a=a|!this.has_children;return a|=this.has_children&&0<this.children.length};e.prototype.loadNode=function(a){d.load&&!this.isLoaded()?(this.setBusy(!0),d.load(this,function(b){b.loaded=!0;h[b.id]=b.id;b.build();a&&a(b);b.setBusy(!1)})):a&&a(this)};e.prototype.loadAll=function(a){this.loadNode(function(b){var c=b.children.length,d=c;if(c)for(b.setBusy(!0);c--;)b.children[c].loadAll(function(){d--;
a&&!d&&(a(b),b.setBusy(!1))});else a(b)})};e.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),this.childlist.show("fast")):0<this.span.length&&(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),this.childlist.hide("fast"));a&&!this.isLoaded()&&this.loadNode(function(a){a.checked&&a.select(a.checked);a.expand(true)})};
e.prototype.selectChildren=function(a){for(var b=this.children.length;b--;)this.children[b].select(a,!0)};e.prototype.check=function(a){this.checked=a;this.input.attr("checked",a);d.selected&&d.selected(this,!0)};e.prototype.select=function(a,b){this.checked=a;this.input.attr("checked",a);this.checked&&d.deepLoad?this.loadAll(function(c){c.selectChildren(a);d.selected&&d.selected(c,!b)}):(this.selectChildren(a),d.selected&&d.selected(this,!b))};e.prototype.build_list=function(){var a=c(),a=c(document.createElement("li"));
a.addClass(this.odd?"odd":"even");return a};e.prototype.build_input=function(a){if(d.inputName){this.input=c(document.createElement("input"));var b=this.value||this.id;this.input.attr({type:"checkbox",value:b,name:d.inputName+"-"+b,checked:this.checked});this.input.css("left",a+"px");this.input.bind("click",function(a){return function(b){b=c(b.target).is(":checked");a.expand(b);a.select(b)}}(this));this.root&&this.input.hide()}return this.input};e.prototype.build_link=function(a){a.css("cursor","pointer").addClass("collapsed");
a.bind("click",{node:this},function(a){a.preventDefault();a.data.node.expand(c(a.target).hasClass("collapsed"))});return a};e.prototype.build_span=function(a){!this.root&&this.has_children&&(this.span=this.build_link(c(document.createElement("span"))),this.span.css("left",a+"px"));return this.span};e.prototype.build_title=function(a){!this.root&&this.title&&(this.link=this.build_link(c(document.createElement("a"))),this.link.css("marginLeft",a+"px").text(this.title));return this.link};e.prototype.build_children=
function(){this.childlist=c();if(0<this.children.length){this.childlist=c(document.createElement("ul"));var a=this.odd,b;for(b in this.children)this.children.hasOwnProperty(b)&&(a=!a,this.children[b]=new e(c.extend(this.children[b],{level:this.level+1,odd:a,checked:this.checked})),this.childlist.append(this.children[b].build()))}return this.childlist};e.prototype.build=function(){var a=5,b=null;0==this.display.length&&(this.display=this.build_list());if(0==this.input.length&&(b=this.build_input(a))&&
0<b.length)this.display.append(b),a+=d.colwidth;0==this.span.length&&(this.display.append(this.build_span(a)),a+=d.colwidth);0==this.link.length&&this.display.append(this.build_title(a));0==this.childlist.length&&this.display.append(this.build_children());if(d.onbuild)d.onbuild(this);return this.display};e.prototype.getSelectAll=function(){return this.root&&this.selectAll?this.selectAllText:!1};e.prototype.setDefault=function(a){jQuery.isEmptyObject(a)||this.loadNode(function(b){(a.hasOwnProperty(b.value)||
a.hasOwnProperty(b.id))&&b.check(!0);for(var c=b.children.length;c--;)b.children[c].setDefault(a)})};return c(this).each(function(){var a=c.extend(d,{display:c(this)}),a=new e(a,!0),b=a.getSelectAll();!1!==b&&(a.display.append(c(document.createElement("input")).attr({type:"checkbox"}).bind("click",function(a){return function(b){a.selectChildren(c(b.target).is(":checked"));d.selected&&d.selected(a,!0)}}(a))),b&&(b=c(document.createElement("span")).html(b),a.display.append(b)));a.loadNode(function(a){a.children.length==
0&&a.display.hide();a.checked&&a.select(a.checked);a.expand(true);a.setDefault(d.default_value)})})}})(jQuery);
(function(c){c.fn.chosentree=function(d){d=c.extend({inputId:"chosentree-select",width:450,label:"",description:"",default_text:"Select Item",min_height:100,more_text:"+%num% more",loaded:null,collapsed:!0},d);return c(this).each(function(){var h=null,e=null,a=null,b=null,g=null,j=null,f=g=null,m=function(a){a?f.addClass("treevisible").show("fast"):f.removeClass("treevisible").hide("fast")},h=c(document.createElement("div"));h.addClass("chzn-container chzn-container-multi");e=c(document.createElement("ul"));
e.addClass("chzn-choices chosentree-choices");a=c(document.createElement("li"));a.addClass("search-field");g=c(document.createElement("label"));g.attr({"for":d.inputId});g.text(d.label);j=c(document.createElement("div"));j.attr({"class":"description"});j.text(d.description);d.default_text&&(b=c(document.createElement("input")),b.attr({type:"text",value:d.default_text,"class":"default",autocomplete:"off"}),b.css("width","100%"),b.focus(function(){m(!0)}),a.append(b));h.append(g).append(e.append(a));
f=c(document.createElement("div"));f.addClass("treewrapper");f.css("width",d.width+"px");f.hide();g=c(document.createElement("div"));g.addClass("treeselect");c(this).keyup(function(a){a.which==27&&m(false)});c(this).append(h.append(f.append(g)));c(this).append(j);var l=d;l.selected=function(g){return function(i,h){var f=c("li#choice_"+i.id,e);if(i.id)if(i.checked&&f.length==0){f=c(document.createElement("li"));f.addClass("search-choice");f.attr("id","choice_"+i.id);f.eq(0)[0].nodeData=i;var j=c(document.createElement("span"));
j.text(i.title);if(!h){var k=c(document.createElement("a"));k.addClass("search-choice-close");k.attr("href","javascript:void(0)");k.bind("click",function(a){a.preventDefault();c("li#choice_"+i.id,e).remove();i.select(false)})}a.before(f.append(j).append(k))}else i.checked||f.remove();if(h){var n=[];g.value={};e.show();b&&i.children.length==0&&b.attr({value:""});c("li.search-choice",e).each(function(){g.value[this.nodeData.id]=this.nodeData.value;n.push(this.nodeData)});if(jQuery.fn.moreorless){k=
d.more_text.replace("%num%",n.length);e.moreorless(d.min_height,k);e.div_expanded||m(true,null)}l.loaded&&l.loaded(n);c(g).trigger("treeloaded")}}}(this);c(g).treeselect(l);l.collapsed||(e.hide(),m(!0,null))})}})(jQuery);
