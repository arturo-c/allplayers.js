(function(c){c.fn.treeselect=function(d){d=c.extend({colwidth:18,default_value:{},selected:null,treeloaded:null,load:null,searcher:null,deepLoad:!1,onbuild:null,postbuild:null,inputName:"treeselect",autoSelectChildren:!0,showRoot:!1,selectAll:!1,selectAllText:"Select All"},d);var m={},g=function(a,b){this.root=!!b;a.title=a.title||"anonymous";c.extend(this,{id:0,nodeloaded:!1,allLoaded:!1,value:0,title:"",url:"",has_children:!0,children:[],data:{},level:0,odd:!1,checked:!1,busy:!1,display:c(),input:c(),
link:c(),span:c(),childlist:c(),exclude:{}},a);this.isTreeNode=!0;this.loading=!1;this.loadqueue=[]};g.prototype.setBusy=function(a,b){a!=this.span.hasClass(b)&&((this.busy=a)?(this.span.addClass(b),this.span.addClass("treebusy")):(this.span.removeClass(b),this.span.hasClass("treebusy-loading"==b?"treebusy-selecting":"treebusy-loading")||this.span.removeClass("treebusy")))};g.prototype.isLoaded=function(){var a=this.nodeloaded,a=a|m.hasOwnProperty(this.id),a=a|!this.has_children;return a|=this.has_children&&
0<this.children.length};g.prototype.loadNode=function(a,b){if(this.loading)a&&this.loadqueue.push(a);else{var c=function(){a&&a(this);for(var c in this.loadqueue)this.loadqueue[c](this);this.loadqueue.length=0;b||this.setBusy(!1,"treebusy-loading")};this.loading=!0;d.load&&!this.isLoaded()?(b||this.setBusy(!0,"treebusy-loading"),d.load(this,function(a){return function(b){a.nodeloaded?c.call(a):(a=jQuery.extend(a,b),a.nodeloaded=!0,m[a.id]=a.id,a.build(function(){c.call(a)}))}}(this))):a&&c.call(this);
this.loading=!1}};g.prototype.loadAll=function(a,b,c,d){d=d||{};this.loadNode(function(f){b&&b(f);var e=f.children.length,h=e;if(!e||d.hasOwnProperty(f.id))a&&a.call(f,f);else for(d[f.id]=f.id,c||f.setBusy(!0,"treebusy-loading-all");e--;)setTimeout(function(e){return function(){f.children[e].loadAll(function(){h--;h||(a&&a.call(f,f),c||f.setBusy(!1,"treebusy-loading-all"))},b,c,d)}}(e),2)})};g.prototype.expand=function(a){a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),
this.childlist.show("fast"),!d.deepLoad&&this.checked&&this.include_children&&(this.include_children=!1,this.selectChildren(!0))):0<this.span.length&&(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),this.childlist.hide("fast"));a&&!this.isLoaded()&&this.loadNode(function(a){a.checked&&a.selectChildren(a.checked);a.expand(!0)})};g.prototype.selectChildren=function(a,b,l){var k="object"==typeof a,f=function(){l||(d.selected&&d.selected(this,
!0),b&&b.call(this))};if(d.deepLoad)this.loadAll(function(){this.setBusy(!1,"treebusy-selecting");f.call(this)},function(b){var c=a;k&&(c=a.hasOwnProperty(b.value),c|=a.hasOwnProperty(b.id));b.select(c)});else{this.select(a);var e=d.inputName+"-"+this.value;c('input[name="'+e+'-include-below"]').attr("name",e);if(!0===this.root||!1===a&&!this.include_children||void 0!==this.link&&void 0!==this.link[0]&&-1!==this.link[0].className.indexOf("expanded"))for(this.include_children=!1,this.expand(a),e=this.children.length;e--;)this.children[e].selectChildren(a,
b,!0);else 0<this.has_children&&a&&(this.include_children=!0,c('input[name="'+e+'"]').attr("name",e+"-include-below"));f.call(this)}};g.prototype.selectDefaults=function(a,b){var l=Object.keys(a).length,k=[];for(k.push(this);0<l&&0<k.length;){var f=k.shift(),e=!1;a.hasOwnProperty(f.value)&&(delete a[f.value],e=!0,l--);a.hasOwnProperty(f.id)&&(delete a[f.id],e=!0,l--);a.hasOwnProperty(f.value+"-include-below")&&(delete a[f.value+"-include-below"],e=f.include_children=!0,l--);a.hasOwnProperty(f.id+
"-include-below")&&(delete a[f.id+"-include-below"],e=f.include_children=!0,l--);f.select(e);var g=d.inputName+"-"+f.value;c('input[name="'+g+'-include-below"]').attr("name",g);if(!f.root&&e&&f.include_children)c('input[name="'+g+'"]').attr("name",g+"-include-below");else if(0<l)for(e=f.children.length;e--;)k.push(f.children[e]);else f.root&&f.include_children&&f.selectChildren(!0)}d.selected&&d.selected(this,!0);b&&b.call(this)};g.prototype.select=function(a){!this.input.hasClass("treenode-no-select")&&
((a=!!a)||!this.root||this.showRoot&&this.has_children)&&(this.checked=a,this.input.attr("checked",a),c('input[name="'+this.input.attr("name")+'"]').change(),d.selected&&d.selected(this))};g.prototype.build_treenode=function(){var a=c(),a=c(document.createElement(this.root?"div":"li"));a.addClass("treenode");a.addClass(this.odd?"odd":"even");return a};g.prototype.build_input=function(a){if(d.inputName){if("undefined"!==typeof this.exclude[this.id]||"group_finder"==d.inputName&&!this.data.roles_enabled)this.input=
c(document.createElement("div")),this.input.addClass("treenode-no-select");else{this.input=c(document.createElement("input"));var b=this.value||this.id;this.input.attr({type:"checkbox",value:b,name:d.inputName+"-"+b,checked:this.checked}).addClass("treenode-input");this.input.bind("click",function(a){return function(b){a.checked=c(b.target).is(":checked");d.autoSelectChildren&&(a.checked&&!d.deepLoad||a.expand(a.checked),a.selectChildren(a.checked))}}(this));this.root&&!d.showRoot&&this.input.hide()}this.input.css("left",
a+"px")}return this.input};g.prototype.build_link=function(a){a.css("cursor","pointer").addClass("collapsed");a.bind("click",{node:this},function(a){a.preventDefault();a.data.node.expand(c(a.target).hasClass("collapsed"))});return a};g.prototype.build_span=function(a){this.root&&!this.showRoot||!this.has_children||(this.span=this.build_link(c(document.createElement("span")).attr({"class":"treeselect-expand"})),this.span.css("left",a+"px"));return this.span};g.prototype.build_title=function(a){this.root&&
!this.showRoot||!this.title||(this.nodeLink=c(document.createElement("a")).attr({"class":"treeselect-title",href:this.url,target:"_blank"}).css("marginLeft",a+"px").text(this.title),this.link=this.has_children?this.build_link(this.nodeLink.clone()):c(document.createElement("div")).attr({"class":"treeselect-title"}).css("marginLeft",a+"px").text(this.title));return this.link};g.prototype.build_children=function(a){this.childlist=c();if(0<this.children.length){this.childlist=c(document.createElement("ul"));
var b=this.odd,d=this.children.length,k;for(k in this.children)this.children.hasOwnProperty(k)&&(b=!b,this.children[k]=new g(c.extend(this.children[k],{level:this.level+1,odd:b,checked:this.checked,exclude:this.exclude})),setTimeout(function(c,b){return function(){c.children[b].build(function(b){d--;c.childlist.append(b.display);d||a.call(c,c.childlist)})}}(this,k),2))}else a.call(this,this.childlist)};g.prototype.build=function(a){var b=5,g=null;if(0==this.display.length)this.display=this.build_treenode();
else if(this.root){var k=this.build_treenode();this.display.append(k);this.display=k}0==this.input.length&&(g=this.build_input(b))&&0<g.length&&(this.display.append(g),b+=d.colwidth);0==this.span.length&&(this.display.append(this.build_span(b)),b+=d.colwidth);0==this.link.length&&this.display.append(this.build_title(b));var f=function(){if(d.onbuild)d.onbuild(this);this.searchItem=this.display.clone();c(".treeselect-expand",this.searchItem).remove();var b=c("div.treeselect-title",this.searchItem);
0<b.length&&b.replaceWith(this.nodeLink);d.postbuild&&d.postbuild(this);"undefined"!==typeof this.exclude[this.id]&&0==c(".treenode-input",this.display).length&&this.display.hide();a&&a.call(this,this)};0==this.childlist.length?this.build_children(function(a){0<a.length&&this.display.append(a);f.call(this)}):f.call(this)};g.prototype.getSelectAll=function(){return this.root&&this.selectAll?this.selectAllText:!1};g.prototype.search=function(a,b){if(a){var c={};a=a.toLowerCase();d.searcher?d.searcher(this,
a,function(a,d){var e=null,h=a.length;0==a.length&&b(c,!0);for(var n in a)e=new g(d?d(a[n]):a[n]),e.nodeloaded=!0,m[e.id]=e.id,e.build(function(){h--;c[n]=e;h||b(c,!0)})}):this.loadAll(function(a){b&&b(c,!0)},function(b){b.root||-1===b.title.toLowerCase().search(a)||(c[b.id]=b)},!0)}else b&&b(this.children,!1)};return c(this).each(function(){var a=c.extend(d,{display:c(this)}),a=this.treenode=new g(a,!0),b=a.getSelectAll();if(!1!==b&&!a.showRoot){var l=!1;d.default_value.hasOwnProperty(a.value+"-include-below")&&
(l=!0);a.display.append(c(document.createElement("input")).attr({type:"checkbox",checked:l}).bind("click",function(a){return function(b){a.selectChildren(c(b.target).is(":checked"))}}(a)));b&&(b=c(document.createElement("span")).attr({"class":"treeselect-select-all"}).html(b),a.display.append(b))}var k=c(document.createElement("span")).addClass("treebusy");a.display.append(k.css("display","block"));var f=function(){k.remove();d.treeloaded&&d.treeloaded(this)};a.loadNode(function(a){0==a.children.length&&
a.display.hide();a.expand(!0);a.select(a.checked);var b=a.checked;jQuery.isEmptyObject(d.default_value)||(b=d.default_value);b?d.deepLoad?a.selectChildren(b,function(){f.call(a)}):a.selectDefaults(b,function(){f.call(a)}):f.call(a)});a.has_children||(this.parentElement.style.display="none")})}})(jQuery);
(function(c){c.fn.chosentree=function(d){d=c.extend({inputId:"chosentree-select",label:"",description:"",input_placeholder:"Select Item",input_type:"text",autosearch:!1,search_text:"Search",no_results_text:"No results found",min_height:100,more_text:"+%num% more",loaded:null,collapsed:!0,showtree:!1},d);return c(this).each(function(){var m=null,g=null,a=null,b=null,l=null,k=null,f=null,e=a=null,h=null,n=function(a,b){a&&(null==h||h.has_children)?e.addClass("treevisible").show("fast"):e.removeClass("treevisible").hide("fast")},
m=c(document.createElement("div"));m.addClass("chzntree-container");"search"==d.input_type?(m.addClass("chzntree-container-single"),a=c(document.createElement("div")),a.addClass("chzntree-search")):(m.addClass("chzntree-container-multi"),g=c(document.createElement("ul")),g.addClass("chzntree-choices chosentree-choices"),a=c(document.createElement("li")),a.addClass("search-field"));k=c(document.createElement("label"));k.attr({"for":d.inputId});k.text(d.label);f=c(document.createElement("div"));f.attr({"class":"description"});
f.text(d.description);if(d.input_placeholder){b=c(document.createElement("input"));b.attr({type:"text",placeholder:d.input_placeholder,autocomplete:"off"});!d.showtree&&d.collapsed&&b.focus(function(a){n(!0)});if("search"==d.input_type){b.addClass("chosentree-search");var r=function(a){return!b.hasClass("searching")&&1!==a.length&&h?(b.addClass("searching"),h.search(a,function(a,c){b.removeClass("searching");var f=0;h.childlist.children().detach();c?h.childlist.addClass("chzntree-search-results"):
h.childlist.removeClass("chzntree-search-results");""!=d.inputName?h.childlist.addClass("input-enabled"):h.childlist.removeClass("input-enabled");for(var g in a)f++,c?h.childlist.append(a[g].searchItem):h.childlist.append(a[g].display);f||h.childlist.append("<li>"+d.no_results_text+"</li>")}),!0):!1};if(d.autosearch){var s=0;b.bind("input",function t(){r(b.val())||(clearTimeout(s),s=setTimeout(t,1E3))});a.addClass("autosearch")}else l=c(document.createElement("input")),l.attr({type:"button",value:d.search_text}),
l.addClass("button chosentree-search-btn"),l.bind("click",function(a){a.preventDefault();r(b.val())}),jQuery(document).bind("keydown",function(a){13==a.keyCode&&b.is(":focus")&&(a.preventDefault(),r(b.val()))}),a.addClass("manualsearch")}else b.addClass("chosentree-results");a.append(b);l&&a.append(l)}g?m.append(k).append(g.append(a)):m.append(k).append(a);e=c(document.createElement("div"));e.addClass("treewrapper");e.hide();a=c(document.createElement("div"));a.addClass("treeselect");c(this).keyup(function(a){27==
a.which&&n(!1)});e.append(a);c(this).append(m.append(e));c(this).append(f);var p=d;p.selected=function(a){var f={};return function(e,k){if(e.id){var h=c("li#choice_"+e.id,g);e.checked?(0!=h.length&&h.remove(),f[e.id]=e):e.checked||h.remove()}if(k){a.value={};for(var l in f){e=f[l];a.value[l]=e;h=c(document.createElement("li"));h.addClass("search-choice");h.attr("id","choice_"+e.id);h.eq(0)[0].nodeData=e;var m=c(document.createElement("span"));!d.deepLoad&&e.include_children?m.text(e.title+" (All below)"):
m.text(e.title);if(!e.root||e.showRoot&&e.has_children){var q=c(document.createElement("a"));q.addClass("search-choice-close");q.attr("href","javascript:void(0)");q.bind("click",function(a){a.preventDefault();e=this.parentNode.nodeData;c("li#choice_"+e.id,g).remove();e.selectChildren(!1)})}g&&g.prepend(h.append(m).append(q))}g&&(g.is(":visible")||g.show(),f={},b&&0==e.children.length&&b.attr({value:""}),jQuery.fn.moreorless&&(l=c("li.search-choice",g).length,l=d.more_text.replace("%num%",l),g.moreorless(d.min_height,
l),g.div_expanded||n(!0,null)));p.loaded&&p.loaded(nodes);c(a).trigger("treeloaded")}}}(this);a.treeselect(p);h=a.eq(0)[0].treenode;!p.showtree&&p.collapsed||n(!0,null)})}})(jQuery);
