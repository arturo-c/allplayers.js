(function(a){a.fn.treeselect=function(c){var c=a.extend({colwidth:18,selected:null,load:null,deepLoad:!1},c),d=function(b){b.title=b.title||"anonymous";a.extend(this,{id:0,value:0,title:"",has_children:!1,children:[],level:0,odd:!1,checked:!1,busy:!1,display:a(),input:a(),link:a(),span:a(),childlist:a()},b)};d.prototype.setBusy=function(b){if(this.busy=b){b=a(document.createElement("div")).addClass("treebusy");b.text("loading...");var f=a("ul",this.display);0==f.length?this.display.append(b):f.prepend(b)}else a("div.treebusy",
this.display).remove()};d.prototype.loadAll=function(b){if(c.load){var a=this.children.length,d=a;if(0===a)this.has_children?c.load(this,function(a){a.build();a.loadAll(b)}):b&&b(this);else for(;a--;)this.children[a].loadAll(function(a){return function(){d--;!d&&b&&b(a)}}(this))}};d.prototype.loadChildren=function(){c.load&&(this.setBusy(!0),c.load(this,function(a){a.build();a.expand(!0)}))};d.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),
this.span.removeClass("collapsed").addClass("expanded"),this.childlist.show("fast")):(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),this.childlist.hide("fast"));a&&0==this.children.length&&this.has_children&&this.loadChildren()};d.prototype.select=function(a,f){this.checked=a;this.input.attr("checked",a);for(var d=this.children.length;d--;)this.children[d].select(a,!0);c.selected&&c.selected(this,!f)};d.prototype.build_list=function(){var b=
a();this.id&&(b=a(document.createElement("li")),b.addClass(this.odd?"odd":"even"));return b};d.prototype.build_input=function(b){this.id&&(this.input=a(document.createElement("input")),this.input.attr({type:"checkbox",value:this.value||this.id,name:"treeselect-"+this.id,checked:this.checked}),this.input.css("left",b+"px"),this.input.bind("click",function(b){return function(d){var e=a(d.target).is(":checked");e&&b.expand(!0);e&&c.deepLoad?(b.setBusy(!0),b.loadAll(function(){b.setBusy(!1);b.select(e)})):
b.select(e)}}(this)));return this.input};d.prototype.build_link=function(b){b.css("cursor","pointer").addClass("collapsed");b.bind("click",{node:this},function(b){b.preventDefault();b.data.node.expand(a(b.target).hasClass("collapsed"))});return b};d.prototype.build_span=function(b){if(this.id&&(0<this.children.length||this.has_children))this.span=this.build_link(a(document.createElement("span"))),this.span.css("left",b+"px");return this.span};d.prototype.build_title=function(b){this.id&&this.title&&
(this.link=this.build_link(a(document.createElement("a"))),this.link.css("marginLeft",b+"px").text(this.title));return this.link};d.prototype.build_children=function(){this.childlist=a();if(0<this.children.length){this.childlist=a(document.createElement("ul"));var b=this.odd,c;for(c in this.children)this.children.hasOwnProperty(c)&&(b=!b,this.children[c]=new d(a.extend(this.children[c],{level:this.level+1,odd:b,checked:this.checked})),this.childlist.append(this.children[c].build()))}return this.childlist};
d.prototype.build=function(){if(!this.id&&0==this.children.length)this.loadChildren();else{var a=0;0==this.display.length&&(this.display=this.build_list());0==this.input.length&&this.display.append(this.build_input(a));0==this.span.length&&(a+=c.colwidth,this.display.append(this.build_span(a)));0==this.link.length&&(a+=c.colwidth,this.display.append(this.build_title(a)));0==this.childlist.length&&this.display.append(this.build_children());this.checked&&this.select(this.checked);this.busy&&this.setBusy(!1)}return this.display};
return a(this).each(function(){(new d(a.extend(c,{display:a(this)}))).build()})}})(jQuery);
(function(a){a.fn.chosentree=function(c){c=a.extend({inputId:"chosentree-select",width:450,title:"",description:"",default_text:"Select Item",loaded:null,collapsed:!0},c);return a(this).each(function(){function d(a){a?g.addClass("treevisible").show("fast"):g.removeClass("treevisible").hide("fast")}var b=null,f=null,k=null,e=null,h=null,i=null,g=e=null,b=a(document.createElement("div"));b.addClass("chzn-container chzn-container-multi");f=a(document.createElement("ul"));f.addClass("chzn-choices chosentree-choices");
k=a(document.createElement("li"));k.addClass("search-field");h=a(document.createElement("label"));h.attr({"for":c.inputId});h.text(c.title);i=a(document.createElement("div"));i.attr({"class":"description"});i.text(c.description);e=a(document.createElement("input"));e.attr({type:"text",name:c.inputId,id:c.inputId,value:c.default_text,"class":"default",autocomplete:"off"});e.css("width","100%");e.focus(function(){d(!0)});b.append(h).append(f.append(k.append(e)));g=a(document.createElement("div"));g.addClass("treewrapper");
g.css("width",c.width+"px");g.hide();e=a(document.createElement("div"));e.addClass("treeselect");a(this).keyup(function(a){27==a.which&&d(!1)});a(this).append(b.append(g.append(e)));a(this).append(i);var j=c;j.selected=function(b){return function(c,d){if(c.checked){var e=a(document.createElement("li"));e.addClass("search-choice");e.attr("id","choice_"+c.id);e.eq(0)[0].nodeData=c;var g=a(document.createElement("span"));g.text(c.title);var h=a(document.createElement("a"));h.addClass("search-choice-close");
h.attr("href","javascript:void(0)");h.bind("click",function(b){b.preventDefault();a("li#choice_"+c.id,f).remove();c.select(!1)});k.before(e.append(g).append(h))}else a("li#choice_"+c.id,f).remove();if(d){var i=[];b.value={};f.show();a("li.search-choice",f).each(function(){b.value[this.nodeData.id]=this.nodeData.value;i.push(this.nodeData)});jQuery.fn.moreorless&&f.moreorless(100,"+"+i.length+" more");j.loaded&&j.loaded(i);a(b).trigger("treeloaded")}}}(this);a(e).treeselect(j);j.collapsed||(f.hide(),
d(!0,null))})}})(jQuery);
