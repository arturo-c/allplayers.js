(function(b){b.fn.treeselect=function(c){c=b.extend({colwidth:18,default_value:{},selected:null,treeloaded:null,load:null,deepLoad:!1,onbuild:null,postbuild:null,inputName:"treeselect",showRoot:!1,selectAll:!1,selectAllText:"Select All"},c);var g={},e=function(a,f){this.root=!!f;a.title=a.title||"anonymous";b.extend(this,{id:0,nodeloaded:!1,allLoaded:!1,value:0,title:"",url:"",has_children:!0,children:[],data:{},level:0,odd:!1,checked:!1,busy:!1,display:b(),input:b(),link:b(),span:b(),childlist:b(),
exclude:{}},a);this.isTreeNode=!0;this.loading=!1;this.loadqueue=[]};e.prototype.setBusy=function(a){a!=this.span.hasClass("treebusy")&&((this.busy=a)?this.span.addClass("treebusy"):this.span.removeClass("treebusy"))};e.prototype.isLoaded=function(){var a=this.nodeloaded,a=a|g.hasOwnProperty(this.id),a=a|!this.has_children;return a|=this.has_children&&0<this.children.length};e.prototype.loadNode=function(a,f){this.loading?a&&this.loadqueue.push(a):(this.loading=!0,c.load&&!this.isLoaded()?(f||this.setBusy(!0),
c.load(this,function(d){return function(b){d.nodeloaded||(d=jQuery.extend(d,b),d.nodeloaded=!0,g[d.id]=d.id,d.build());a&&a(d);for(var c in d.loadqueue)d.loadqueue[c](d);d.loadqueue.length=0;f||d.setBusy(!1)}}(this))):a&&a(this),this.loading=!1)};e.prototype.loadAll=function(a,f,d,b){b=b||{};this.loadNode(function(c){f&&f(c);var e=c.children.length,h=e;if(!e||b.hasOwnProperty(c.id))a&&a(c);else{b[c.id]=c.id;for(d||c.setBusy(!0);e--;)c.children[e].loadAll(function(){h--;h||(a&&a(c),d||c.setBusy(!1))},
f,d,b)}})};e.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),this.childlist.show("fast")):0<this.span.length&&(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),this.childlist.hide("fast"));a&&!this.isLoaded()&&this.loadNode(function(a){a.checked&&a.select(a.checked);a.expand(!0)})};e.prototype.selectChildren=
function(a){for(var b=this.children.length;b--;)this.children[b].select(a,!0)};e.prototype.check=function(a){this.checked=a;this.input.attr("checked",a);c.selected&&c.selected(this,!0)};e.prototype.select=function(a,b){this.input.hasClass("treenode-no-select")||(this.checked=a,this.input.attr("checked",a));a&&c.deepLoad?this.loadAll(function(d){d.selectChildren(a);c.selected&&c.selected(d,!b)}):(this.selectChildren(a),c.selected&&c.selected(this,!b))};e.prototype.build_treenode=function(){var a=b(),
a=b(document.createElement(this.root?"div":"li"));a.addClass("treenode");a.addClass(this.odd?"odd":"even");return a};e.prototype.build_input=function(a){if(c.inputName){if("undefined"!==typeof this.exclude[this.id])this.input=b(document.createElement("div")),this.input.addClass("treenode-no-select");else{this.input=b(document.createElement("input"));var f=this.value||this.id;this.input.attr({type:"checkbox",value:f,name:c.inputName+"-"+f,checked:this.checked}).addClass("treenode-input");this.input.bind("click",
function(a){return function(c){c=b(c.target).is(":checked");a.expand(c);a.select(c)}}(this));this.root&&!c.showRoot&&this.input.hide()}this.input.css("left",a+"px")}return this.input};e.prototype.build_link=function(a){a.css("cursor","pointer").addClass("collapsed");a.bind("click",{node:this},function(a){a.preventDefault();a.data.node.expand(b(a.target).hasClass("collapsed"))});return a};e.prototype.build_span=function(a){if((!this.root||this.showRoot)&&this.has_children)this.span=this.build_link(b(document.createElement("span")).attr({"class":"treeselect-expand"})),
this.span.css("left",a+"px");return this.span};e.prototype.build_title=function(a){if((!this.root||this.showRoot)&&this.title)this.nodeLink=b(document.createElement("a")).attr({"class":"treeselect-title",href:this.url,target:"_blank"}).css("marginLeft",a+"px").text(this.title),this.link=this.has_children?this.build_link(this.nodeLink.clone()):b(document.createElement("div")).attr({"class":"treeselect-title"}).css("marginLeft",a+"px").text(this.title);return this.link};e.prototype.build_children=function(){this.childlist=
b();if(0<this.children.length){this.childlist=b(document.createElement("ul"));var a=this.odd,c;for(c in this.children)this.children.hasOwnProperty(c)&&(a=!a,this.children[c]=new e(b.extend(this.children[c],{level:this.level+1,odd:a,checked:this.checked,exclude:this.exclude})),this.childlist.append(this.children[c].build()))}return this.childlist};e.prototype.build=function(){var a=5,f=null;if(0==this.display.length)this.display=this.build_treenode();else if(this.root){var d=this.build_treenode();
this.display.append(d);this.display=d}if(0==this.input.length&&(f=this.build_input(a))&&0<f.length)this.display.append(f),a+=c.colwidth;0==this.span.length&&(this.display.append(this.build_span(a)),a+=c.colwidth);0==this.link.length&&this.display.append(this.build_title(a));0==this.childlist.length&&this.display.append(this.build_children());if(c.onbuild)c.onbuild(this);this.searchItem=this.display.clone();b(".treeselect-expand",this.searchItem).remove();a=b("div.treeselect-title",this.searchItem);
0<a.length&&a.replaceWith(this.nodeLink);c.postbuild&&c.postbuild(this);"undefined"!==typeof this.exclude[this.id]&&0==b(".treenode-input",this.display).length&&this.display.hide();return this.display};e.prototype.getSelectAll=function(){return this.root&&this.selectAll?this.selectAllText:!1};e.prototype.setDefault=function(a,b){jQuery.isEmptyObject(a)?b&&b(this):this.loadAll(function(a){b&&b(a)},function(b){(a.hasOwnProperty(b.value)||a.hasOwnProperty(b.id))&&b.check(!0)})};e.prototype.search=function(a,
b){if(a){var c={};a=a.toLowerCase();this.loadAll(function(){b&&b(c,!0)},function(b){!b.root&&-1!==b.title.toLowerCase().search(a)&&(c[b.id]=b)},!0)}else b&&b(this.children,!1)};return b(this).each(function(){var a=b.extend(c,{display:b(this)}),a=this.treenode=new e(a,!0),f=a.getSelectAll();!1!==f&&!a.showRoot&&(a.display.append(b(document.createElement("input")).attr({type:"checkbox"}).bind("click",function(a){return function(e){a.selectChildren(b(e.target).is(":checked"));c.selected&&c.selected(a,
!0)}}(a))),f&&(f=b(document.createElement("span")).attr({"class":"treeselect-select-all"}).html(f),a.display.append(f)));a.loadNode(function(a){0==a.children.length&&a.display.hide();a.checked&&a.select(a.checked);a.expand(!0);a.setDefault(c.default_value,function(a){c.treeloaded&&c.treeloaded(a)})});a.has_children||(this.parentElement.style.display="none")})}})(jQuery);
(function(b){b.fn.chosentree=function(c){c=b.extend({inputId:"chosentree-select",label:"",description:"",input_placeholder:"Select Item",input_type:"text",no_results_text:"No results found",min_height:100,more_text:"+%num% more",loaded:null,collapsed:!0,showtree:!1},c);return b(this).each(function(){var g=null,e=null,a=null,f=null,d=null,q=null,n=null,j=d=null,h=null,p=function(a){a&&(null==h||h.has_children)?j.addClass("treevisible").show("fast"):j.removeClass("treevisible").hide("fast")},g=b(document.createElement("div"));
g.addClass("chzntree-container");"search"==c.input_type?(g.addClass("chzntree-container-single"),a=b(document.createElement("div")),a.addClass("chzntree-search")):(g.addClass("chzntree-container-multi"),e=b(document.createElement("ul")),e.addClass("chzntree-choices chosentree-choices"),a=b(document.createElement("li")),a.addClass("search-field"));d=b(document.createElement("label"));d.attr({"for":c.inputId});d.text(c.label);n=b(document.createElement("div"));n.attr({"class":"description"});n.text(c.description);
if(c.input_placeholder){f=b(document.createElement("input"));f.attr({type:"text",placeholder:c.input_placeholder,autocomplete:"off"});!c.showtree&&c.collapsed&&f.focus(function(){p(!0)});if("search"==c.input_type){f.addClass("chosentree-search");var s=0,k="";f.bind("input",function t(){k=f.val();!f.hasClass("searching")&&1!==k.length?h&&(f.addClass("searching"),h.search(k,function(a){return function(b,e){f.removeClass("searching");if(k!=a)t();else{var d=0;h.childlist.children().detach();e?h.childlist.addClass("chzntree-search-results"):
h.childlist.removeClass("chzntree-search-results");for(var g in b)d++,e?h.childlist.append(b[g].searchItem):h.childlist.append(b[g].display);d||h.childlist.append("<li>"+c.no_results_text+"</li>")}}}(k))):(clearTimeout(s),s=setTimeout(t,1E3))})}else f.addClass("chosentree-results");a.append(f)}e?g.append(d).append(e.append(a)):g.append(d).append(a);j=b(document.createElement("div"));j.addClass("treewrapper");j.hide();q=b(document.createElement("span")).attr({"class":"tree-loading treebusy"}).css("display",
"block");d=b(document.createElement("div"));d.addClass("treeselect");b(this).keyup(function(a){27==a.which&&p(!1)});j.append(d.append(q));b(this).append(g.append(j));b(this).append(n);var l=c,r=this;l.selected=function(d,h){var g=b("li#choice_"+d.id,e);if(d.id)if(d.checked&&0==g.length){g=b(document.createElement("li"));g.addClass("search-choice");g.attr("id","choice_"+d.id);g.eq(0)[0].nodeData=d;var j=b(document.createElement("span"));j.text(d.title);if(!d.root||d.showRoot&&d.has_children){var m=
b(document.createElement("a"));m.addClass("search-choice-close");m.attr("href","javascript:void(0)");m.bind("click",function(a){a.preventDefault();b("li#choice_"+d.id,e).remove();d.select(!1)})}a.before(g.append(j).append(m))}else d.checked||g.remove();if(h){var k=[];r.value={};e.show();f&&0==d.children.length&&f.attr({value:""});b("li.search-choice",e).each(function(){r.value[this.nodeData.id]=this.nodeData.value;k.push(this.nodeData)});jQuery.fn.moreorless&&(m=c.more_text.replace("%num%",k.length),
e.moreorless(c.min_height,m),e.div_expanded||p(!0,null));l.loaded&&l.loaded(k);b(r).trigger("treeloaded")}};l.treeloaded=function(){q.remove()};d.treeselect(l);h=d.eq(0)[0].treenode;(l.showtree||!l.collapsed)&&p(!0,null)})}})(jQuery);
