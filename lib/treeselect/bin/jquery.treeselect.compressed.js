(function(a){a.fn.treeselect=function(c){var c=a.extend({margin:"18px",basecolor:238,gradient:0,colwidth:18,selected:null,load:null},c),e=function(b){a.extend(this,{id:0,title:"",has_children:!1,children:[],level:0,odd:!1,checked:!1,busy:!1,display:a(),input:a(),link:a(),span:a(),childlist:a()},b)};e.prototype.setBusy=function(b){(this.busy=b)?this.display.append(a(document.createElement("div")).addClass("treebusy")):a("div.treebusy",this.display).remove()};e.prototype.loadAll=function(b){if(c.load)if(0==
this.children.length&&this.has_children)c.load(this,function(a){a.build();a.loadAll(b)});else for(var a=this.children.length,f=a,e=this;a--;)this.children[a].loadAll(function(){f--;!f&&b&&b(e)})};e.prototype.loadChildren=function(){c.load&&(this.setBusy(!0),c.load(this,function(a){a.build();a.expand(!0)}))};e.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),this.childlist.show("fast")):
(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),this.childlist.hide("fast"));a&&0==this.children.length&&this.has_children&&this.loadChildren()};e.prototype.select=function(a,d){d=!!d;this.checked=a;this.input.attr("checked",a);c.selected&&c.selected(this,a);if(!d)for(var f=this.children.length;f--;)this.children[f].select(a)};e.prototype.build_list=function(){var b=a();if(this.id){var b=a(document.createElement("li")),d=this.odd?"odd":
"even";if("odd"==d){var f=c.basecolor-this.level*c.gradient,f=f.toString(16);b.css("backgroundColor","#"+(f+f+f))}b.addClass(d)}return b};e.prototype.build_input=function(b){if(this.id)this.input=a(document.createElement("input")),this.input.attr({type:"checkbox",value:this.id,name:"treeselect-"+this.id,checked:this.checked}),this.input.css("left",b+"px"),this.input.bind("click",{node:this},function(b){var c=a(b.target).is(":checked");c&&b.data.node.expand(!0);b.data.node.select(c)});return this.input};
e.prototype.build_link=function(b){b.css("cursor","pointer").addClass("collapsed");b.bind("click",{node:this},function(b){b.preventDefault();b.data.node.expand(a(b.target).hasClass("collapsed"))});return b};e.prototype.build_span=function(b){if(this.id&&(0<this.children.length||this.has_children))this.span=this.build_link(a(document.createElement("span"))),this.span.css("left",b+"px");return this.span};e.prototype.build_title=function(b){if(this.id&&this.title)this.link=this.build_link(a(document.createElement("a"))),
this.link.css("marginLeft",b+"px").text(this.title);return this.link};e.prototype.build_children=function(){this.childlist=a();if(0<this.children.length){this.childlist=a(document.createElement("ul"));0<this.level&&(this.childlist.css("marginLeft",c.margin),this.childlist.css("marginRight",c.margin));var b=this.odd,d;for(d in this.children)this.children.hasOwnProperty(d)&&(b=!b,this.children[d]=new e(a.extend(this.children[d],{level:this.level+1,odd:b,checked:this.checked})),this.childlist.append(this.children[d].build()))}return this.childlist};
e.prototype.build=function(){if(!this.id&&0==this.children.length)this.loadChildren();else{var a=0;if(0==this.display.length)this.display=this.build_list();0==this.input.length&&this.display.append(this.build_input(a));0==this.span.length&&(a+=c.colwidth,this.display.append(this.build_span(a)));0==this.link.length&&(a+=c.colwidth,this.display.append(this.build_title(a)));0==this.childlist.length&&this.display.append(this.build_children());this.checked&&this.select(this.checked);this.busy&&this.setBusy(!1)}return this.display};
return a(this).each(function(){(new e(a.extend(c,{display:a(this)}))).build()})}})(jQuery);
(function(a){a.fn.chosentree=function(c){c=a.extend({width:350,default_text:"Select Item",selected:null},c);return a(this).each(function(){function e(a){a?h.addClass("treevisible").show("fast"):h.removeClass("treevisible").hide("fast")}function b(b,c){if(c){var d=a(document.createElement("li"));d.addClass("search-choice");d.attr("id","choice_"+b.id);var e=a(document.createElement("span"));e.text(b.title);var g=a(document.createElement("a"));g.addClass("search-choice-close");g.attr("href","javascript:void(0)");
g.bind("click",{node:b},function(b){b.preventDefault();a("li#choice_"+b.data.node.id,f).remove();b.data.node.select(!1)});i.before(d.append(e).append(g))}else a("li#choice_"+b.id,f).remove()}var d=null,f=null,i=null,g=null,h=g=null,d=a(document.createElement("div"));d.addClass("chzn-container chzn-container-multi");f=a(document.createElement("ul"));f.addClass("chzn-choices");f.css("width",c.width+"px");i=a(document.createElement("li"));i.addClass("search-field");g=a(document.createElement("input"));
g.attr({type:"text",value:c.default_text,"class":"default",autocomplete:"off"});g.css("width","100%");g.focus(function(){e(!0)});d.append(f.append(i.append(g)));h=a(document.createElement("div"));h.addClass("treewrapper");h.css("width",c.width+"px");h.hide();g=a(document.createElement("div"));g.addClass("treeselect");a(this).keyup(function(a){27==a.which&&e(!1)});a(this).append(d.append(h.append(g)));d=c;d.selected=function(a,c){b(a,c)};a(g).treeselect(d)})}})(jQuery);
