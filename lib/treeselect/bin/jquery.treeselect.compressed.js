(function(b){b.fn.treeselect=function(c){var c=b.extend({colwidth:18,selected:null,load:null,deepLoad:!1,selectAll:!1,selectAllText:"Select All"},c),d=function(a){a.title=a.title||"anonymous";b.extend(this,{id:0,loaded:!1,value:0,title:"",has_children:!0,children:[],level:0,odd:!1,checked:!1,busy:!1,display:b(),input:b(),link:b(),span:b(),childlist:b()},a);this.isTreeNode=!0};d.prototype.setBusy=function(a){if(a!=this.busy)if(this.busy=a){a=b(document.createElement("div")).addClass("treebusy");a.text("loading...");
var e=b("ul",this.display);0==e.length?this.display.append(a):e.prepend(a)}else b("div.treebusy",this.display).remove()};d.prototype.isLoaded=function(){var a=this.loaded,a=a|!this.has_children;return a|=this.has_children&&0<this.children.length};d.prototype.loadNode=function(a){c.load&&!this.isLoaded()?(this.setBusy(!0),c.load(this,function(e){e.loaded=!0;e.build();a&&a(e);e.setBusy(!1)})):a&&a(this)};d.prototype.loadAll=function(a){this.loadNode(function(e){var b=e.children.length,c=b;if(b)for(e.setBusy(!0);b--;)e.children[b].loadAll(function(){c--;
a&&!c&&(a(e),e.setBusy(!1))});else a(e)})};d.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),this.childlist.show("fast")):0<this.span.length&&(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),this.childlist.hide("fast"));a&&!this.isLoaded()&&this.loadNode(function(a){a.checked&&a.select(a.checked);a.expand(true)})};
d.prototype.selectChildren=function(a){for(var b=this.children.length;b--;)this.children[b].select(a,!0)};d.prototype.select=function(a,b){this.checked=a;this.input.attr("checked",a);this.checked&&c.deepLoad?this.loadAll(function(d){d.selectChildren(a);c.selected&&c.selected(d,!b)}):(this.selectChildren(a),c.selected&&c.selected(this,!b))};d.prototype.build_list=function(){var a=b();this.id&&(a=b(document.createElement("li")),a.addClass(this.odd?"odd":"even"));return a};d.prototype.build_input=function(a){if(this.id||
c.selectAll)this.input=b(document.createElement("input")),this.input.attr({type:"checkbox",value:this.value||this.id,name:"treeselect-"+this.id,checked:this.checked}),this.input.css("left",a+"px"),this.input.bind("click",function(a){return function(c){c=b(c.target).is(":checked");a.expand(c);a.select(c)}}(this));return this.input};d.prototype.build_link=function(a){a.css("cursor","pointer").addClass("collapsed");a.bind("click",{node:this},function(a){a.preventDefault();a.data.node.expand(b(a.target).hasClass("collapsed"))});
return a};d.prototype.build_span=function(a){this.id&&this.has_children&&(this.span=this.build_link(b(document.createElement("span"))),this.span.css("left",a+"px"));return this.span};d.prototype.build_title=function(a){this.id&&this.title&&(this.link=this.build_link(b(document.createElement("a"))),this.link.css("marginLeft",a+"px").text(this.title));return this.link};d.prototype.build_children=function(){this.childlist=b();if(0<this.children.length){this.childlist=b(document.createElement("ul"));
var a=this.odd,c;for(c in this.children)this.children.hasOwnProperty(c)&&(a=!a,this.children[c]=new d(b.extend(this.children[c],{level:this.level+1,odd:a,checked:this.checked})),this.childlist.append(this.children[c].build()))}return this.childlist};d.prototype.build=function(){var a=0;0==this.display.length&&(this.display=this.build_list());0==this.input.length&&this.display.append(this.build_input(a));!this.id&&c.selectAll&&c.selectAllText&&this.display.append("&nbsp;"+c.selectAllText);0==this.span.length&&
(a+=c.colwidth,this.display.append(this.build_span(a)));0==this.link.length&&(a+=c.colwidth,this.display.append(this.build_title(a)));0==this.childlist.length&&this.display.append(this.build_children());return this.display};return b(this).each(function(){var a=b.extend(c,{display:b(this)});(new d(a)).loadNode(function(a){a.checked&&a.select(a.checked);a.expand(!0)})})}})(jQuery);
(function(b){b.fn.chosentree=function(c){c=b.extend({inputId:"chosentree-select",width:450,title:"",description:"",default_text:"Select Item",min_height:100,more_text:"+%num% more",loaded:null,collapsed:!0},c);return b(this).each(function(){function d(a){a?g.addClass("treevisible").show("fast"):g.removeClass("treevisible").hide("fast")}var a=null,e=null,l=null,f=null,h=null,j=null,g=f=null,a=b(document.createElement("div"));a.addClass("chzn-container chzn-container-multi");e=b(document.createElement("ul"));
e.addClass("chzn-choices chosentree-choices");l=b(document.createElement("li"));l.addClass("search-field");h=b(document.createElement("label"));h.attr({"for":c.inputId});h.text(c.title);j=b(document.createElement("div"));j.attr({"class":"description"});j.text(c.description);f=b(document.createElement("input"));f.attr({type:"text",name:c.inputId,id:c.inputId,value:c.default_text,"class":"default",autocomplete:"off"});f.css("width","100%");f.focus(function(){d(!0)});a.append(h).append(e.append(l.append(f)));
g=b(document.createElement("div"));g.addClass("treewrapper");g.css("width",c.width+"px");g.hide();f=b(document.createElement("div"));f.addClass("treeselect");b(this).keyup(function(a){27==a.which&&d(!1)});b(this).append(a.append(g.append(f)));b(this).append(j);var k=c;k.selected=function(a){return function(d,f){var i=b("li#choice_"+d.id,e);if(d.id)if(d.checked&&0==i.length){i=b(document.createElement("li"));i.addClass("search-choice");i.attr("id","choice_"+d.id);i.eq(0)[0].nodeData=d;var g=b(document.createElement("span"));
g.text(d.title);var h=b(document.createElement("a"));h.addClass("search-choice-close");h.attr("href","javascript:void(0)");h.bind("click",function(a){a.preventDefault();b("li#choice_"+d.id,e).remove();d.select(!1)});l.before(i.append(g).append(h))}else d.checked||i.remove();if(f){var j=[];a.value={};e.show();b("li.search-choice",e).each(function(){a.value[this.nodeData.id]=this.nodeData.value;j.push(this.nodeData)});jQuery.fn.moreorless&&(i=c.more_text.replace("%num%",j.length),e.moreorless(c.min_height,
i));k.loaded&&k.loaded(j);b(a).trigger("treeloaded")}}}(this);b(f).treeselect(k);k.collapsed||(e.hide(),d(!0,null))})}})(jQuery);
