(function(b){b.fn.treeselect=function(d){var d=b.extend({colwidth:18,default_value:{},selected:null,load:null,deepLoad:!1,inputName:"treeselect",selectAll:!1,selectAllText:"Select All"},d),e=function(a,c){this.root=!!c;a.title=a.title||"anonymous";b.extend(this,{id:0,loaded:!1,value:0,title:"",has_children:!0,children:[],level:0,odd:!1,checked:!1,busy:!1,display:b(),input:b(),link:b(),span:b(),childlist:b()},a);this.isTreeNode=!0};e.prototype.setBusy=function(a){if(a!=this.busy)if(this.busy=a){a=
b(document.createElement("div")).addClass("treebusy");a.text("loading...");var c=b("ul",this.display);0==c.length?this.display.append(a):c.prepend(a)}else b("div.treebusy",this.display).remove()};e.prototype.isLoaded=function(){var a=this.loaded,a=a|!this.has_children;return a|=this.has_children&&0<this.children.length};e.prototype.loadNode=function(a){d.load&&!this.isLoaded()?(this.setBusy(!0),d.load(this,function(c){c.loaded=!0;c.build();a&&a(c);c.setBusy(!1)})):a&&a(this)};e.prototype.loadAll=
function(a){this.loadNode(function(c){var b=c.children.length,d=b;if(b)for(c.setBusy(!0);b--;)c.children[b].loadAll(function(){d--;a&&!d&&(a(c),c.setBusy(!1))});else a(c)})};e.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),this.childlist.show("fast")):0<this.span.length&&(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),
this.childlist.hide("fast"));a&&!this.isLoaded()&&this.loadNode(function(a){a.checked&&a.select(a.checked);a.expand(true)})};e.prototype.selectChildren=function(a){for(var b=this.children.length;b--;)this.children[b].select(a,!0)};e.prototype.check=function(a){this.checked=a;this.input.attr("checked",a);d.selected&&d.selected(this,!0)};e.prototype.select=function(a,b){this.checked=a;this.input.attr("checked",a);this.checked&&d.deepLoad?this.loadAll(function(i){i.selectChildren(a);d.selected&&d.selected(i,
!b)}):(this.selectChildren(a),d.selected&&d.selected(this,!b))};e.prototype.build_list=function(){var a=b(),a=b(document.createElement("li"));a.addClass(this.odd?"odd":"even");return a};e.prototype.build_input=function(a){this.input=b(document.createElement("input"));var c=this.value||this.id;this.input.attr({type:"checkbox",value:c,name:d.inputName+"-"+c,checked:this.checked});this.input.css("left",a+"px");this.input.bind("click",function(a){return function(c){c=b(c.target).is(":checked");a.expand(c);
a.select(c)}}(this));this.root&&this.input.hide();return this.input};e.prototype.build_link=function(a){a.css("cursor","pointer").addClass("collapsed");a.bind("click",{node:this},function(a){a.preventDefault();a.data.node.expand(b(a.target).hasClass("collapsed"))});return a};e.prototype.build_span=function(a){!this.root&&this.has_children&&(this.span=this.build_link(b(document.createElement("span"))),this.span.css("left",a+"px"));return this.span};e.prototype.build_title=function(a){!this.root&&this.title&&
(this.link=this.build_link(b(document.createElement("a"))),this.link.css("marginLeft",a+"px").text(this.title));return this.link};e.prototype.build_children=function(){this.childlist=b();if(0<this.children.length){this.childlist=b(document.createElement("ul"));var a=this.odd,c;for(c in this.children)this.children.hasOwnProperty(c)&&(a=!a,this.children[c]=new e(b.extend(this.children[c],{level:this.level+1,odd:a,checked:this.checked})),this.childlist.append(this.children[c].build()))}return this.childlist};
e.prototype.build=function(){var a=0;0==this.display.length&&(this.display=this.build_list());0==this.input.length&&this.display.append(this.build_input(a));0==this.span.length&&(a+=d.colwidth,this.display.append(this.build_span(a)));0==this.link.length&&(a+=d.colwidth,this.display.append(this.build_title(a)));0==this.childlist.length&&this.display.append(this.build_children());return this.display};e.prototype.getSelectAll=function(){return this.root&&this.selectAll?this.selectAllText:!1};e.prototype.setDefault=
function(a){a&&this.loadNode(function(b){(a.hasOwnProperty(b.value)||a.hasOwnProperty(b.id))&&b.check(!0);for(var d=b.children.length;d--;)b.children[d].setDefault(a)})};return b(this).each(function(){var a=b.extend(d,{display:b(this)}),a=new e(a,!0),c=a.getSelectAll();!1!==c&&(a.display.append(b(document.createElement("input")).attr({type:"checkbox"}).bind("click",function(a){return function(c){a.selectChildren(b(c.target).is(":checked"));d.selected&&d.selected({},!0)}}(a))),c&&(c=b(document.createElement("span")).html(c),
a.display.append(c)));a.loadNode(function(a){a.children.length==0&&a.display.hide();a.checked&&a.select(a.checked);a.expand(true);a.setDefault(d.default_value)})})}})(jQuery);
(function(b){b.fn.chosentree=function(d){d=b.extend({inputId:"chosentree-select",width:450,label:"",description:"",default_text:"Select Item",min_height:100,more_text:"+%num% more",loaded:null,collapsed:!0},d);return b(this).each(function(){var e=null,a=null,c=null,i=null,g=null,j=null,f=g=null,m=function(a){a?f.addClass("treevisible").show("fast"):f.removeClass("treevisible").hide("fast")},e=b(document.createElement("div"));e.addClass("chzn-container chzn-container-multi");a=b(document.createElement("ul"));
a.addClass("chzn-choices chosentree-choices");c=b(document.createElement("li"));c.addClass("search-field");g=b(document.createElement("label"));g.attr({"for":d.inputId});g.text(d.label);j=b(document.createElement("div"));j.attr({"class":"description"});j.text(d.description);d.default_text&&(i=b(document.createElement("input")),i.attr({type:"text",value:d.default_text,"class":"default",autocomplete:"off"}),i.css("width","100%"),i.focus(function(){m(!0)}),c.append(i));e.append(g).append(a.append(c));
f=b(document.createElement("div"));f.addClass("treewrapper");f.css("width",d.width+"px");f.hide();g=b(document.createElement("div"));g.addClass("treeselect");b(this).keyup(function(a){a.which==27&&m(false)});b(this).append(e.append(f.append(g)));b(this).append(j);var l=d;l.selected=function(e){return function(h,g){var f=b("li#choice_"+h.id,a);if(h.id)if(h.checked&&f.length==0){f=b(document.createElement("li"));f.addClass("search-choice");f.attr("id","choice_"+h.id);f.eq(0)[0].nodeData=h;var j=b(document.createElement("span"));
j.text(h.title);if(!g){var k=b(document.createElement("a"));k.addClass("search-choice-close");k.attr("href","javascript:void(0)");k.bind("click",function(c){c.preventDefault();b("li#choice_"+h.id,a).remove();h.select(false)})}c.before(f.append(j).append(k))}else h.checked||f.remove();if(g){var n=[];e.value={};a.show();h.children.length==0&&i.attr({value:""});b("li.search-choice",a).each(function(){e.value[this.nodeData.id]=this.nodeData.value;n.push(this.nodeData)});if(jQuery.fn.moreorless){k=d.more_text.replace("%num%",
n.length);a.moreorless(d.min_height,k);a.div_expanded||m(true,null)}l.loaded&&l.loaded(n);b(e).trigger("treeloaded")}}}(this);b(g).treeselect(l);l.collapsed||(a.hide(),m(!0,null))})}})(jQuery);
