(function(c){c.fn.treeselect=function(e){function n(b,a,f,d){var i=c('input[ref="'+a+'"]'),j=i.is(":checked");if(0<c('span[ref="'+a+'"]').length)if(d){if(0==c('ul[ref="'+a+'"]').length&&e.load){var b=c(b),d=i.css("left"),m=b.parent("li"),l=m.hasClass("odd"),b=c("<ul><li></li></ul>");b.find("li").addClass("treebusy").css("marginLeft",d);m.append(b);m.find("ul").attr("ref",a).addClass("expanded").show("fast");e.load(a,function(a){treeparams=c.extend(e,{tree:a,level:f+1,odd:l,checked:j});m.find("ul").empty().treeselect(treeparams)})}else c('ul[ref="'+
a+'"]').show("fast");c('[ref="'+a+'"]').removeClass("collapsed").addClass("expanded")}else c('ul[ref="'+a+'"]').hide("fast"),c('[ref="'+a+'"]').removeClass("expanded").addClass("collapsed");else"input"!=b.nodeName.toLowerCase()&&i.attr("checked",!j)}function o(c,a){var c=c||e.tree,a=a||null,f="",d="",i;for(i in c)if(c.hasOwnProperty(i))var j=c[i],d=d+"<li>",d=d+o(j.children?j.children:[],j),d=d+"</li>";if(a){if(d||a.has_children)f+='<span class="collapsed"></span>';f+='<input type="checkbox" name="treeselect-'+
a.id+'" />';f+='<a href="#" class="collapsed">'+a.title+"</a>"}d&&(f=f+(a?"<ul>":"")+d+(a?"</ul>":""));return f}function p(b,a,f,d,i,j){var d=d||e.tree,a=a||0,f=f||0,j=j||!1,m=a*e.margin,l=0,i=i||!1;b.each(function(){var b=c(this),g=(i=!i)?"odd":"even",k=d&&d[l].id?d[l].id:f+"-"+l,h=0;"odd"==g&&(h=e.basecolor-a*e.gradient,h=h.toString(16),b.css("backgroundColor","#"+(h+h+h)));b.addClass(g);h=m;g=b.children("input:checkbox");g.attr({ref:k,value:k,checked:j});g.css("left",h+"px");g.bind("click",{id:k,
level:a},function(a){var b=c(a.target).is(":checked");b&&n(a.target,a.data.id,a.data.level,!0);c('ul[ref="'+a.data.id+'"] input').each(function(){c(this).attr("checked",b)})});g=b.children("span");h+=e.colwidth+e.space;g.attr("ref",k);g.css({cursor:"pointer",left:h+"px"});g.bind("click",{id:k,level:a},function(a){a.preventDefault();var b=c(a.target).hasClass("collapsed");n(a.target,a.data.id,a.data.level,b)});g=b.children("a");h+=e.colwidth+e.space;g.attr("ref",k);g.css({cursor:"pointer",marginLeft:h+
"px"});g.bind("click",{id:k,level:a},function(a){a.preventDefault();var b=c(a.target).hasClass("collapsed");n(a.target,a.data.id,a.data.level,b)});b=b.children("ul");b.attr("ref",k);b=b.children("li");0<b.length&&p(b,a+1,k,d?d[l].children:null,i,j);l++})}e=c.extend({margin:18,space:4,basecolor:238,gradient:0,colwidth:13,tree:null,load:null,loaded:null,level:0,odd:!1,checked:!1},e);return c(this).each(function(){var b=c(this).children("li");0==b.length&&(c(this).append(o()),b=c(this).children("li"));
p(b,e.level,null,null,e.odd,e.checked);e.loaded&&e.loaded(this)})}})(jQuery);
