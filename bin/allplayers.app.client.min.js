var NO_JQUERY={};
(function(c,k,m){if(!("console"in c)){var l=c.console={};l.log=l.warn=l.error=l.debug=function(){}}k===NO_JQUERY&&(k={fn:{},extend:function(){for(var a=arguments[0],d=1,e=arguments.length;d<e;d++){var b=arguments[d],f;for(f in b)a[f]=b[f]}return a}});k.fn.pm=function(){console.log("usage: \nto send:    $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this};k.pm=c.pm=function(a){b.send(a)};k.pm.bind=c.pm.bind=function(a,d,e,c,f){b.bind(a,d,e,c,!0===f)};k.pm.unbind=c.pm.unbind=function(a,
d){b.unbind(a,d)};k.pm.origin=c.pm.origin=null;k.pm.poll=c.pm.poll=200;var b={send:function(a){a=k.extend({},b.defaults,a);var d=a.target;if(a.target)if(a.type){var e={data:a.data,type:a.type};a.success&&(e.callback=b._callback(a.success));a.error&&(e.errback=b._callback(a.error));"postMessage"in d&&!a.hash?(b._bind(),d.postMessage(JSON.stringify(e),a.origin||"*")):(b.hash._bind(),b.hash.send(a,e))}else console.warn("postmessage type required");else console.warn("postmessage target window required")},
bind:function(a,d,e,c,f){b._replyBind(a,d,e,c,f)},_replyBind:function(a,d,e,h,f){"postMessage"in c&&!h?b._bind():b.hash._bind();h=b.data("listeners.postmessage");h||(h={},b.data("listeners.postmessage",h));var n=h[a];n||(n=[],h[a]=n);n.push({fn:d,callback:f,origin:e||k.pm.origin})},unbind:function(a,d){var e=b.data("listeners.postmessage");if(e)if(a)if(d){var c=e[a];if(c){for(var f=[],n=0,r=c.length;n<r;n++){var g=c[n];g.fn!==d&&f.push(g)}e[a]=f}}else delete e[a];else for(n in e)delete e[n]},data:function(a,
d){return d===m?b._data[a]:b._data[a]=d},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var a=[],d=0;32>d;d++)a[d]=b._CHARS[0|32*Math.random()];return a.join("")},_callback:function(a){var d=b.data("callbacks.postmessage");d||(d={},b.data("callbacks.postmessage",d));var e=b._random();d[e]=a;return e},_bind:function(){b.data("listening.postmessage")||(c.addEventListener?c.addEventListener("message",b._dispatch,!1):c.attachEvent&&c.attachEvent("onmessage",
b._dispatch),b.data("listening.postmessage",1))},_dispatch:function(a){try{var d=JSON.parse(a.data)}catch(e){console.warn("postmessage data invalid json: ",e);return}if(d.type){var c=(b.data("callbacks.postmessage")||{})[d.type];if(c)c(d.data);else for(var c=(b.data("listeners.postmessage")||{})[d.type]||[],f=0,n=c.length;f<n;f++){var r=c[f];if(r.origin&&"*"!==r.origin&&a.origin!==r.origin)console.warn("postmessage message origin mismatch",a.origin,r.origin),d.errback&&b.send({target:a.source,data:{message:"postmessage origin mismatch",
origin:[a.origin,r.origin]},type:d.errback});else{var g=function(e){d.callback&&b.send({target:a.source,data:e,type:d.callback})};try{r.callback?r.fn(d.data,g,a):g(r.fn(d.data,a))}catch(q){if(d.errback)b.send({target:a.source,data:q,type:d.errback});else throw q;}}}}else console.warn("postmessage message type required")},hash:{send:function(a,d){var e=a.target,h=a.url;if(h){var h=b.hash._url(h),f,n=b.hash._url(c.location.href);if(c==e.parent)f="parent";else try{for(var r=0,g=parent.frames.length;r<
g;r++)if(parent.frames[r]==c){f=r;break}}catch(q){f=c.name}null==f?console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list"):(f={"x-requested-with":"postmessage",source:{name:f,url:n},postmessage:d},n="#x-postmessage-id="+b._random(),e.location=h+n+encodeURIComponent(JSON.stringify(f)))}else console.warn("postmessage target window url is required")},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:50,_bind:function(){b.data("polling.postmessage")||
(setInterval(function(){var a=""+c.location.hash,d=b.hash._regex.exec(a);d&&(d=d[1],b.hash._last!==d&&(b.hash._last=d,b.hash._dispatch(a.substring(b.hash._regex_len))))},k.pm.poll||200),b.data("polling.postmessage",1))},_dispatch:function(a){if(a){try{if(a=JSON.parse(decodeURIComponent(a)),!("postmessage"===a["x-requested-with"]&&a.source&&null!=a.source.name&&a.source.url&&a.postmessage))return}catch(d){return}var e=a.postmessage,h=(b.data("callbacks.postmessage")||{})[e.type];if(h)h(e.data);else{var f;
f="parent"===a.source.name?c.parent:c.frames[a.source.name];for(var h=(b.data("listeners.postmessage")||{})[e.type]||[],n=0,r=h.length;n<r;n++){var g=h[n];if(g.origin){var q=/https?\:\/\/[^\/]*/.exec(a.source.url)[0];if("*"!==g.origin&&q!==g.origin){console.warn("postmessage message origin mismatch",q,g.origin);e.errback&&b.send({target:f,data:{message:"postmessage origin mismatch",origin:[q,g.origin]},type:e.errback,hash:!0,url:a.source.url});continue}}q=function(d){e.callback&&b.send({target:f,
data:d,type:e.callback,hash:!0,url:a.source.url})};try{g.callback?g.fn(e.data,q):q(g.fn(e.data))}catch(k){if(e.errback)b.send({target:f,data:k,type:e.errback,hash:!0,url:a.source.url});else throw k;}}}}},_url:function(a){return(""+a).replace(/#.*$/,"")}}};k.extend(b,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})})(this,"undefined"===typeof jQuery?NO_JQUERY:jQuery);"JSON"in window&&window.JSON||(JSON={});
(function(){function c(a){return 10>a?"0"+a:a}function k(a){b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var d=e[a];return"string"===typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function m(e,c){var b,g,q,l,t=a,s,p=c[e];p&&"object"===typeof p&&"function"===typeof p.toJSON&&(p=p.toJSON(e));"function"===typeof h&&(p=h.call(c,e,p));switch(typeof p){case "string":return k(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);
case "object":if(!p)return"null";a+=d;s=[];if("[object Array]"===Object.prototype.toString.apply(p)){l=p.length;for(b=0;b<l;b+=1)s[b]=m(b,p)||"null";q=0===s.length?"[]":a?"[\n"+a+s.join(",\n"+a)+"\n"+t+"]":"["+s.join(",")+"]";a=t;return q}if(h&&"object"===typeof h)for(l=h.length,b=0;b<l;b+=1)g=h[b],"string"===typeof g&&(q=m(g,p))&&s.push(k(g)+(a?": ":":")+q);else for(g in p)Object.hasOwnProperty.call(p,g)&&(q=m(g,p))&&s.push(k(g)+(a?": ":":")+q);q=0===s.length?"{}":a?"{\n"+a+s.join(",\n"+a)+"\n"+
t+"}":"{"+s.join(",")+"}";a=t;return q}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var l=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,d,e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!==typeof JSON.stringify&&(JSON.stringify=function(e,b,c){var g;d=a="";if("number"===typeof c)for(g=0;g<c;g+=1)d+=" ";else"string"===typeof c&&(d=c);if((h=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return m("",{"":e})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,d){function b(a,e){var c,g,f=a[e];if(f&&"object"===typeof f)for(c in f)Object.hasOwnProperty.call(f,c)&&(g=b(f,c),void 0!==g?f[c]=g:delete f[c]);return d.call(a,e,f)}var e;l.lastIndex=0;l.test(a)&&(a=a.replace(l,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return e=eval("("+a+")"),"function"===typeof d?b({"":e},""):e;throw new SyntaxError("JSON.parse");})})();var allplayers=allplayers||{};allplayers.app=function(c,k){if(k){c=c||{};for(var m in k)c.hasOwnProperty(m)||(c[m]=k[m]);this.options=c;this.init()}};allplayers.app.getParam=function(c){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");c=RegExp("[\\?&]"+c+"=([^&#]*)").exec(window.location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))};
allplayers.app.prototype.init=function(){document.proxy=this};allplayers=allplayers||{app:{}};
(function(c,k,m,l,b){m.app.client=function(a){m.app.call(this,a,{getContainer:function(){return l()}})};m.app.client.prototype=new m.app;m.app.client.prototype.constructor=m.app.client;m.app.client.prototype.init=function(){m.app.prototype.init.call(this);this.ehost=m.app.getParam("ehost");this.container=this.options.getContainer();this.height=0;this.heightTimer=null;this.queue={};this.checkout=this.reg=null;this.type="registration";var a=this,b=null;l(k).bind("DOMSubtreeModified",function(){b&&clearTimeout(b);
b=setTimeout(function(){a.resize()},500)});l.pm.bind("chromeMsgResp",function(b){if(b.hasOwnProperty("guid")&&a.queue.hasOwnProperty(b.guid))a.queue[b.guid](b.response)});l.pm.bind("getRegistration",function(b){a.reg=b;a.type="registration"});l.pm.bind("getCheckout",function(b){a.checkout=b;a.type="checkout"});this.resize();l.pm({target:c.parent,url:this.ehost,type:"clientReady"})};m.app.client.prototype.sendMessage=function(a,b){var c=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};
a.guid=c()+c()+c();this.proxy.post({event:{name:"chromeMsg",data:a}});this.queue[a.guid]=b};m.app.client.prototype.resize=function(){l('a[href^="https://www."]',this.container).each(function(){var a=l(this).attr("href");l(this).attr({href:a.replace(/https:\/\/www.(.*?).allplayers.com/,"https://platform.$1.allplayers.com")})});var a=this,b=function(){var e=a.container.outerHeight(!0);a.height!==e&&(a.height=e,l.pm({target:c.parent,url:a.ehost,type:"init",data:{height:e,id:c.location.hash},success:function(b){a.height=
b.height}}));a.heightTimer&&clearTimeout(a.heightTimer);a.heightTimer=setTimeout(b,500)};b()}})(window,document,window.allplayers,jQuery);
