var NO_JQUERY={};
(function(e,l,h){if(!("console"in e)){var a=e.console={};a.log=a.warn=a.error=a.debug=function(){}}l===NO_JQUERY&&(l={fn:{},extend:function(){for(var b=arguments[0],s=1,a=arguments.length;s<a;s++){var d=arguments[s],f;for(f in d)b[f]=d[f]}return b}});l.fn.pm=function(){console.log("usage: \nto send:    $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this};l.pm=e.pm=function(b){d.send(b)};l.pm.bind=e.pm.bind=function(b,a,c,g,f){d.bind(b,a,c,g,!0===f)};l.pm.unbind=e.pm.unbind=function(b,
a){d.unbind(b,a)};l.pm.origin=e.pm.origin=null;l.pm.poll=e.pm.poll=200;var d={send:function(b){b=l.extend({},d.defaults,b);var a=b.target;if(b.target)if(b.type){var c={data:b.data,type:b.type};b.success&&(c.callback=d._callback(b.success));b.error&&(c.errback=d._callback(b.error));"postMessage"in a&&!b.hash?(d._bind(),a.postMessage(JSON.stringify(c),b.origin||"*")):(d.hash._bind(),d.hash.send(b,c))}else console.warn("postmessage type required");else console.warn("postmessage target window required")},
bind:function(b,a,c,g,f){d._replyBind(b,a,c,g,f)},_replyBind:function(b,a,c,g,f){"postMessage"in e&&!g?d._bind():d.hash._bind();g=d.data("listeners.postmessage");g||(g={},d.data("listeners.postmessage",g));var r=g[b];r||(r=[],g[b]=r);r.push({fn:a,callback:f,origin:c||l.pm.origin})},unbind:function(b,a){var c=d.data("listeners.postmessage");if(c)if(b)if(a){var g=c[b];if(g){for(var f=[],e=0,q=g.length;e<q;e++){var n=g[e];n.fn!==a&&f.push(n)}c[b]=f}}else delete c[b];else for(e in c)delete c[e]},data:function(b,
a){return a===h?d._data[b]:d._data[b]=a},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var b=[],a=0;32>a;a++)b[a]=d._CHARS[0|32*Math.random()];return b.join("")},_callback:function(b){var a=d.data("callbacks.postmessage");a||(a={},d.data("callbacks.postmessage",a));var c=d._random();a[c]=b;return c},_bind:function(){d.data("listening.postmessage")||(e.addEventListener?e.addEventListener("message",d._dispatch,!1):e.attachEvent&&e.attachEvent("onmessage",
d._dispatch),d.data("listening.postmessage",1))},_dispatch:function(b){try{var a=JSON.parse(b.data)}catch(c){console.warn("postmessage data invalid json: ",c);return}if(a.type){var e=(d.data("callbacks.postmessage")||{})[a.type];if(e)e(a.data);else for(var e=(d.data("listeners.postmessage")||{})[a.type]||[],f=0,r=e.length;f<r;f++){var q=e[f];if(q.origin&&"*"!==q.origin&&b.origin!==q.origin)console.warn("postmessage message origin mismatch",b.origin,q.origin),a.errback&&d.send({target:b.source,data:{message:"postmessage origin mismatch",
origin:[b.origin,q.origin]},type:a.errback});else{var n=function(f){a.callback&&d.send({target:b.source,data:f,type:a.callback})};try{q.callback?q.fn(a.data,n,b):n(q.fn(a.data,b))}catch(m){if(a.errback)d.send({target:b.source,data:m,type:a.errback});else throw m;}}}}else console.warn("postmessage message type required")},hash:{send:function(a,h){var c=a.target,g=a.url;if(g){var g=d.hash._url(g),f,r=d.hash._url(e.location.href);if(e==c.parent)f="parent";else try{for(var q=0,n=parent.frames.length;q<
n;q++)if(parent.frames[q]==e){f=q;break}}catch(m){f=e.name}null==f?console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list"):(f={"x-requested-with":"postmessage",source:{name:f,url:r},postmessage:h},r="#x-postmessage-id="+d._random(),c.location=g+r+encodeURIComponent(JSON.stringify(f)))}else console.warn("postmessage target window url is required")},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:50,_bind:function(){d.data("polling.postmessage")||
(setInterval(function(){var a=""+e.location.hash,h=d.hash._regex.exec(a);h&&(h=h[1],d.hash._last!==h&&(d.hash._last=h,d.hash._dispatch(a.substring(d.hash._regex_len))))},l.pm.poll||200),d.data("polling.postmessage",1))},_dispatch:function(a){if(a){try{if(a=JSON.parse(decodeURIComponent(a)),!("postmessage"===a["x-requested-with"]&&a.source&&null!=a.source.name&&a.source.url&&a.postmessage))return}catch(h){return}var c=a.postmessage,g=(d.data("callbacks.postmessage")||{})[c.type];if(g)g(c.data);else{var f;
f="parent"===a.source.name?e.parent:e.frames[a.source.name];for(var g=(d.data("listeners.postmessage")||{})[c.type]||[],r=0,q=g.length;r<q;r++){var n=g[r];if(n.origin){var m=/https?\:\/\/[^\/]*/.exec(a.source.url)[0];if("*"!==n.origin&&m!==n.origin){console.warn("postmessage message origin mismatch",m,n.origin);c.errback&&d.send({target:f,data:{message:"postmessage origin mismatch",origin:[m,n.origin]},type:c.errback,hash:!0,url:a.source.url});continue}}m=function(e){c.callback&&d.send({target:f,
data:e,type:c.callback,hash:!0,url:a.source.url})};try{n.callback?n.fn(c.data,m):m(n.fn(c.data))}catch(l){if(c.errback)d.send({target:f,data:l,type:c.errback,hash:!0,url:a.source.url});else throw l;}}}}},_url:function(a){return(""+a).replace(/#.*$/,"")}}};l.extend(d,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})})(this,"undefined"===typeof jQuery?NO_JQUERY:jQuery);"JSON"in window&&window.JSON||(JSON={});
(function(){function e(a){return 10>a?"0"+a:a}function l(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=c[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function h(a,c){var d,e,m,t,u=b,p,k=c[a];k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(a));"function"===typeof g&&(k=g.call(c,a,k));switch(typeof k){case "string":return l(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);
case "object":if(!k)return"null";b+=s;p=[];if("[object Array]"===Object.prototype.toString.apply(k)){t=k.length;for(d=0;d<t;d+=1)p[d]=h(d,k)||"null";m=0===p.length?"[]":b?"[\n"+b+p.join(",\n"+b)+"\n"+u+"]":"["+p.join(",")+"]";b=u;return m}if(g&&"object"===typeof g)for(t=g.length,d=0;d<t;d+=1)e=g[d],"string"===typeof e&&(m=h(e,k))&&p.push(l(e)+(b?": ":":")+m);else for(e in k)Object.hasOwnProperty.call(k,e)&&(m=h(e,k))&&p.push(l(e)+(b?": ":":")+m);m=0===p.length?"{}":b?"{\n"+b+p.join(",\n"+b)+"\n"+
u+"}":"{"+p.join(",")+"}";b=u;return m}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,s,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,d,e){var c;s=b="";if("number"===typeof e)for(c=0;c<e;c+=1)s+=" ";else"string"===typeof e&&(s=e);if((g=d)&&"function"!==typeof d&&("object"!==typeof d||"number"!==typeof d.length))throw Error("JSON.stringify");return h("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(b,d){function e(a,b){var c,p,k=a[b];if(k&&"object"===typeof k)for(c in k)Object.hasOwnProperty.call(k,c)&&(p=e(k,c),void 0!==p?k[c]=p:delete k[c]);return d.call(a,b,k)}var c;a.lastIndex=0;a.test(b)&&(b=b.replace(a,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return c=eval("("+b+")"),"function"===typeof d?e({"":c},""):c;throw new SyntaxError("JSON.parse");})})();var allplayers=allplayers||{};allplayers.app=function(e,l){if(l){e=e||{};for(var h in l)e.hasOwnProperty(h)||(e[h]=l[h]);this.options=e;this.init()}};allplayers.app.getParam=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");e=RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))};
allplayers.app.prototype.init=function(){document.proxy=this};allplayers=allplayers||{app:{}};
(function(e,l,h,a,d){a&&!a.fn.allplayers_server&&(a.fn.allplayers_server=function(b){return a(this).each(function(){new h.app.server(b,a(this))})});h.app.server=function(a,d){this.context=d;h.app.call(this,a,{spinner:"",loading:"Loading",base:"https://platform.allplayers.com",type:"registration",group:"api",query:{},reg:{},checkout:{},src:"",style:"",complete:function(){}})};h.app.server.prototype=new h.app;h.app.server.prototype.constructor=h.app.server;h.app.server.prototype.init=function(){h.app.prototype.init.call(this);
this.baseURL="https://platform.allplayers.com";this.options.base&&(this.baseURL=this.options.base);this.isLoading=!0;this.options.spinner||(this.options.spinner=this.options.base,this.options.spinner+="/sites/all/themes/basic_foundation",this.options.spinner+="/images/loader.gif");this.pluginReady=!1;var b=a(l.createElement("div")).css({background:"url("+this.options.spinner+") no-repeat 10px 13px",padding:"10px 10px 10px 60px",width:"100%"});b.append(this.options.loading);var d=this.context.attr("id")+
"_iframe",c="";if(c=h.app.getParam("apq"))c=this.options.base+"/"+c;else if(this.options.src)c=this.options.src;else{c=this.options.base+"/g/"+this.options.group;switch(this.options.type){case "registration":c+="/register";break;case "forms":c+="/forms"}this.options.query.etyp=this.options.type}c+=-1===c.search(/\?/)?"?":"&";if(!function(a){for(var b in a)return!1;return!0}(this.options.query))for(var e in this.options.query)c+=e+"="+encodeURIComponent(this.options.query[e]),c+="&";var c=c+("#"+d),
f=this,r=a(l.createElement("iframe")).attr({id:d,name:d,scrolling:"no",seamless:"seamless",width:"100%",height:"0px",src:c}).css({border:"none",overflowY:"hidden"});this.context.append(b);this.context.append(r);this.serverTarget=null;a.pm.bind("chromePluginReady",function(){f.pluginReady=!0});a.pm.bind("chromeMsgResp",function(p){a.pm({target:f.serverTarget,url:f.baseURL,type:"chromeMsgResp",data:p})});a.pm.bind("chromeMsg",function(p){a.pm({target:f.serverTarget,url:f.baseURL,type:"chromeMsg",data:p})});
a.pm.bind("init",function(a,d){f.serverTarget=d.source;f.isLoading=!1;b.remove();r.height(a.height).attr("height",a.height+"px");return a});var q=function(a){return a.product_uuid&&a.price&&a.quantity&&a.title},n=function(p){return a('input[product="'+p+'"]')},m=function(a){a.price_raw||(a.price_raw=100*accounting.unformat(a.price));a.price=accounting.formatMoney(a.price);a.total=accounting.formatMoney(a.price_raw*a.quantity/100);return a},t=function(a,b){var d=!0;if(a){a=JSON.parse(a);for(var c=
0;c<a.length;c++)if(a[c].title==b.title&&a[c].price_raw==b.price_raw){d=!1;a[c].quantity+=b.quantity;a[c].total=accounting.formatMoney(a[c].price_raw*a[c].quantity/100);b=a[c];break}}else a=[];d&&a.push(b);u(b);return a};h.app.server.prototype.init.processCheckout=function(p,b,c,d){d=p.commerce_order_total.und[0].amount;for(var e=0;e<b.length;e++)d+=b[e].price_raw;for(e=0;e<c.length;e++)d+=c[e].price_raw;e=d;a("#edit-commerce-payment-payment-details-amount")&&(e=100*parseFloat(a("#edit-commerce-payment-payment-details-amount").val()));
a.pm({target:f.serverTarget,url:f.baseURL,type:"processCheckout",data:{checkout:p,adhocProducts:b,existingProducts:c,orderTotal:d,paid:e}})};var u=function(b){var d=!0;b.product_uuid?0<a("tr#adhoc-product-"+b.product_uuid).length&&(a("tr#adhoc-product-"+b.product_uuid+" .quantity").text(b.quantity),a("tr#adhoc-product-"+b.product_uuid+" .total").text(b.total),d=!1):a(".views-table tbody tr").each(function(){var c=a(this).find(".title").text(),e=a(this).find(".price").text();if(c&&e&&-1!==c.indexOf(b.title)&&
-1!==e.indexOf(b.price))return a(this).find(".quantity").text(b.quantity),a(this).find(".total").text(b.total),d=!1});d&&a(".views-table tbody").append('<tr id="adhoc-product-'+b.product_uuid+'"><td class="title">'+b.title+'</td><td class="seller"></td><td class="price">'+b.price+'</td><td class="quantity">'+b.quantity+'</td><td class="total">'+b.total+"</td></tr>");var c=a("td.component-total"),e=c.text(),e=accounting.unformat(e)+b.price_raw/100,e=accounting.formatMoney(e);c.text(e)};a.pm.bind("addProduct",
function(b){b&&b.product_uuid?(new h.product({uuid:b.product_uuid})).getProduct(b.product_uuid,function(c){if(c.uuid==b.product_uuid){var d=b.product_uuid,e=n(d).val();b.title=c.title;if(e)e=JSON.parse(e),e.quantity=parseInt(e.quantity),e.quantity+=parseInt(b.quantity),n(d).val(JSON.stringify(e)),a("#add-product-display-"+d+" td:last").text(e.quantity);else if(q(b)){if("undefined"==b.price||"product"==c.type&&0<c.price_raw)b.price=c.price_raw/100;b=m(b);a("<input>").attr({type:"hidden",product:d,
name:"add-product[]",value:JSON.stringify(b)}).appendTo("form#og-registration-register-app");a("#edit-next").val("Continue");0==a("#add-products-table").length&&(a("<table>").attr({id:"add-products-table","class":"sticky-table"}).appendTo("#add-products"),a("#add-products-table").append("<thead><tr><th>Added Products</th><th>Price</th><th>Quantity</th></tr></thead><tbody></tbody>"));a("#add-products-table tbody").append('<tr id="add-product-display-'+d+'"><td>'+b.title+"</td><td>"+b.price+"</td><td>"+
b.quantity+"</td></tr>")}}else alert("There was an error adding the product.")}):(b=m(b),b.title+=" (Adhoc)",a("<input>").attr({type:"hidden",product:"",name:"add-product[]",value:JSON.stringify(b)}).appendTo("form#og-registration-register-app"),a("#edit-next").val("Continue"),0==a("#add-products-table").length&&(a("<table>").attr({id:"add-products-table","class":"sticky-table"}).appendTo("#add-products"),a("#add-products-table").append("<thead><tr><th>Added Products</th><th>Price</th><th>Quantity</th></tr></thead><tbody></tbody>")),
a("#add-products-table tbody").append("<tr><td>"+b.title+"</td><td>"+b.price+"</td><td>"+b.quantity+"</td></tr>"))});a.pm.bind("addCheckoutProduct",function(b){if(b&&b.product_uuid)(new h.product({uuid:b.product_uuid})).getProduct(b.product_uuid,function(c){if(c&&c.uuid==b.product_uuid){var e=b.product_uuid,d=n(e).val(),g=a("#add-existing-products-"+f.options.checkout.order_id).val();if(d)d=JSON.parse(d),d.quantity=parseInt(d.quantity),d.quantity+=parseInt(b.quantity),n(e).val(JSON.stringify(d)),
a("#adhoc-product-"+e+" td.quantity").text(d.quantity);else if(q(b)){if("undefined"==b.price||"product"==c.type&&0<c.price_raw)b.price=c.price_raw/100,b.price_raw=c.price_raw;b.title=c.title;b=m(b)}g=t(g,b);a("#add-existing-products-"+f.options.checkout.order_id).val(JSON.stringify(g))}else alert("There was an error adding the product.")});else{b=m(b);b.title+=" (Adhoc)";var c=a("#add-adhoc-products-"+f.options.checkout.order_id).val(),c=t(c,b);a("#add-adhoc-products-"+f.options.checkout.order_id).val(JSON.stringify(c))}});
a.pm.bind("removeProduct",function(b){b=b.product_uuid;n(b).val()&&(n(b).remove(),a("#add-product-display-"+b).remove())});a.pm.bind("clientReady",function(b,c){f.serverTarget=c.source;f.pluginReady&&a.pm({target:c.source,url:f.baseURL,type:"chromePluginReady"});"registration"==f.options.type?a.pm({target:c.source,url:f.baseURL,type:"getRegistration",data:f.options.reg}):"checkout"==f.options.type&&a.pm({target:c.source,url:f.baseURL,type:"getCheckout",data:f.options.checkout})})}})(window,document,
window.allplayers,jQuery);
