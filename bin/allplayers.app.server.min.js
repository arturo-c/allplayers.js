var NO_JQUERY={};
(function(c,h,e){if(!("console"in c)){var l=c.console={};l.log=l.warn=l.error=l.debug=function(){}}h===NO_JQUERY&&(h={fn:{},extend:function(){for(var a=arguments[0],b=1,f=arguments.length;b<f;b++){var g=arguments[b],k;for(k in g)a[k]=g[k]}return a}});h.fn.pm=function(){console.log("usage: \nto send:    $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this};h.pm=c.pm=function(a){b.send(a)};h.pm.bind=c.pm.bind=function(a,d,f,g,k){b.bind(a,d,f,g,!0===k)};h.pm.unbind=c.pm.unbind=function(a,
d){b.unbind(a,d)};h.pm.origin=c.pm.origin=null;h.pm.poll=c.pm.poll=200;var b={send:function(a){a=h.extend({},b.defaults,a);var d=a.target;if(a.target)if(a.type){var f={data:a.data,type:a.type};a.success&&(f.callback=b._callback(a.success));a.error&&(f.errback=b._callback(a.error));"postMessage"in d&&!a.hash?(b._bind(),d.postMessage(JSON.stringify(f),a.origin||"*")):(b.hash._bind(),b.hash.send(a,f))}else console.warn("postmessage type required");else console.warn("postmessage target window required")},
bind:function(a,d,f,g,k){b._replyBind(a,d,f,g,k)},_replyBind:function(a,d,f,g,k){"postMessage"in c&&!g?b._bind():b.hash._bind();g=b.data("listeners.postmessage");g||(g={},b.data("listeners.postmessage",g));var q=g[a];q||(q=[],g[a]=q);q.push({fn:d,callback:k,origin:f||h.pm.origin})},unbind:function(a,d){var f=b.data("listeners.postmessage");if(f)if(a)if(d){var g=f[a];if(g){for(var k=[],c=0,n=g.length;c<n;c++){var p=g[c];p.fn!==d&&k.push(p)}f[a]=k}}else delete f[a];else for(c in f)delete f[c]},data:function(a,
d){return d===e?b._data[a]:b._data[a]=d},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var a=[],d=0;32>d;d++)a[d]=b._CHARS[0|32*Math.random()];return a.join("")},_callback:function(a){var d=b.data("callbacks.postmessage");d||(d={},b.data("callbacks.postmessage",d));var f=b._random();d[f]=a;return f},_bind:function(){b.data("listening.postmessage")||(c.addEventListener?c.addEventListener("message",b._dispatch,!1):c.attachEvent&&c.attachEvent("onmessage",
b._dispatch),b.data("listening.postmessage",1))},_dispatch:function(a){try{var d=JSON.parse(a.data)}catch(f){console.warn("postmessage data invalid json: ",f);return}if(d.type){var g=(b.data("callbacks.postmessage")||{})[d.type];if(g)g(d.data);else for(var g=(b.data("listeners.postmessage")||{})[d.type]||[],k=0,c=g.length;k<c;k++){var n=g[k];if(n.origin&&"*"!==n.origin&&a.origin!==n.origin)console.warn("postmessage message origin mismatch",a.origin,n.origin),d.errback&&b.send({target:a.source,data:{message:"postmessage origin mismatch",
origin:[a.origin,n.origin]},type:d.errback});else{var p=function(f){d.callback&&b.send({target:a.source,data:f,type:d.callback})};try{n.callback?n.fn(d.data,p,a):p(n.fn(d.data,a))}catch(e){if(d.errback)b.send({target:a.source,data:e,type:d.errback});else throw e;}}}}else console.warn("postmessage message type required")},hash:{send:function(a,d){var f=a.target,g=a.url;if(g){var g=b.hash._url(g),k,q=b.hash._url(c.location.href);if(c==f.parent)k="parent";else try{for(var n=0,p=parent.frames.length;n<
p;n++)if(parent.frames[n]==c){k=n;break}}catch(e){k=c.name}null==k?console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list"):(k={"x-requested-with":"postmessage",source:{name:k,url:q},postmessage:d},q="#x-postmessage-id="+b._random(),f.location=g+q+encodeURIComponent(JSON.stringify(k)))}else console.warn("postmessage target window url is required")},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:50,_bind:function(){b.data("polling.postmessage")||
(setInterval(function(){var a=""+c.location.hash,d=b.hash._regex.exec(a);d&&(d=d[1],b.hash._last!==d&&(b.hash._last=d,b.hash._dispatch(a.substring(b.hash._regex_len))))},h.pm.poll||200),b.data("polling.postmessage",1))},_dispatch:function(a){if(a){try{if(a=JSON.parse(decodeURIComponent(a)),!("postmessage"===a["x-requested-with"]&&a.source&&null!=a.source.name&&a.source.url&&a.postmessage))return}catch(d){return}var f=a.postmessage,g=(b.data("callbacks.postmessage")||{})[f.type];if(g)g(f.data);else{var k;
k="parent"===a.source.name?c.parent:c.frames[a.source.name];for(var g=(b.data("listeners.postmessage")||{})[f.type]||[],q=0,n=g.length;q<n;q++){var e=g[q];if(e.origin){var h=/https?\:\/\/[^\/]*/.exec(a.source.url)[0];if("*"!==e.origin&&h!==e.origin){console.warn("postmessage message origin mismatch",h,e.origin);f.errback&&b.send({target:k,data:{message:"postmessage origin mismatch",origin:[h,e.origin]},type:f.errback,hash:!0,url:a.source.url});continue}}h=function(d){f.callback&&b.send({target:k,
data:d,type:f.callback,hash:!0,url:a.source.url})};try{e.callback?e.fn(f.data,h):h(e.fn(f.data))}catch(l){if(f.errback)b.send({target:k,data:l,type:f.errback,hash:!0,url:a.source.url});else throw l;}}}}},_url:function(a){return(""+a).replace(/#.*$/,"")}}};h.extend(b,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})})(this,"undefined"===typeof jQuery?NO_JQUERY:jQuery);"JSON"in window&&window.JSON||(JSON={});
(function(){function c(a){return 10>a?"0"+a:a}function h(a){b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var b=f[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(f,b){var c,p,l,s,t=a,r,m=b[f];m&&"object"===typeof m&&"function"===typeof m.toJSON&&(m=m.toJSON(f));"function"===typeof g&&(m=g.call(b,f,m));switch(typeof m){case "string":return h(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);
case "object":if(!m)return"null";a+=d;r=[];if("[object Array]"===Object.prototype.toString.apply(m)){s=m.length;for(c=0;c<s;c+=1)r[c]=e(c,m)||"null";l=0===r.length?"[]":a?"[\n"+a+r.join(",\n"+a)+"\n"+t+"]":"["+r.join(",")+"]";a=t;return l}if(g&&"object"===typeof g)for(s=g.length,c=0;c<s;c+=1)p=g[c],"string"===typeof p&&(l=e(p,m))&&r.push(h(p)+(a?": ":":")+l);else for(p in m)Object.hasOwnProperty.call(m,p)&&(l=e(p,m))&&r.push(h(p)+(a?": ":":")+l);l=0===r.length?"{}":a?"{\n"+a+r.join(",\n"+a)+"\n"+
t+"}":"{"+r.join(",")+"}";a=t;return l}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var l=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,d,f={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g;"function"!==typeof JSON.stringify&&(JSON.stringify=function(f,b,c){var h;d=a="";if("number"===typeof c)for(h=0;h<c;h+=1)d+=" ";else"string"===typeof c&&(d=c);if((g=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return e("",{"":f})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,f){function b(a,c){var d,g,e=a[c];if(e&&"object"===typeof e)for(d in e)Object.hasOwnProperty.call(e,d)&&(g=b(e,d),void 0!==g?e[d]=g:delete e[d]);return f.call(a,c,e)}var c;l.lastIndex=0;l.test(a)&&(a=a.replace(l,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return c=eval("("+a+")"),"function"===typeof f?b({"":c},""):c;throw new SyntaxError("JSON.parse");})})();var allplayers=allplayers||{};allplayers.app=function(c,h){if(h){c=c||{};for(var e in h)c.hasOwnProperty(e)||(c[e]=h[e]);this.options=c;this.init()}};allplayers.app.getParam=function(c){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");c=RegExp("[\\?&]"+c+"=([^&#]*)").exec(window.location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))};
allplayers.app.prototype.init=function(){document.proxy=this};allplayers=allplayers||{app:{}};jQuery.fn.allplayers_server||(jQuery.fn.allplayers_server=function(c){return jQuery(this).each(function(){new allplayers.app.server(c,jQuery(this))})});allplayers.app.server=function(c,h){this.context=h;allplayers.app.call(this,c,{spinner:"",loading:"Loading",base:"https://platform.allplayers.com",type:"registration",group:"api",query:{},reg:{},checkout:{},src:"",style:"",complete:function(){}})};
allplayers.app.server.prototype=new allplayers.app;allplayers.app.server.prototype.constructor=allplayers.app.server;
allplayers.app.server.prototype.init=function(){allplayers.app.prototype.init.call(this);this.baseURL="https://platform.allplayers.com";this.options.base&&(this.baseURL=this.options.base);this.isLoading=!0;this.options.spinner||(this.options.spinner=this.options.base,this.options.spinner+="/sites/all/themes/basic_foundation",this.options.spinner+="/images/loader.gif");this.pluginReady=!1;var c=jQuery(document.createElement("div")).css({background:"url("+this.options.spinner+") no-repeat 10px 13px",
padding:"10px 10px 10px 60px",width:"100%"});c.append(this.options.loading);var h=this.context.attr("id")+"_iframe",e="";if(e=allplayers.app.getParam("apq"))e=this.options.base+"/"+e;else if(this.options.src)e=this.options.src;else{e=this.options.base+"/g/"+this.options.group;switch(this.options.type){case "registration":e+="/register";break;case "forms":e+="/forms"}this.options.query.etyp=this.options.type}e+=-1===e.search(/\?/)?"?":"&";if(!function(a){for(var b in a)return!1;return!0}(this.options.query))for(var l in this.options.query)e+=
l+"="+encodeURIComponent(this.options.query[l]),e+="&";var e=e+("#"+h),b=this,a=jQuery(document.createElement("iframe")).attr({id:h,name:h,scrolling:"no",seamless:"seamless",width:"100%",height:"0px",src:e}).css({border:"none",overflowY:"hidden"});this.context.append(c);this.context.append(a);this.serverTarget=null;$.pm.bind("chromePluginReady",function(){b.pluginReady=!0});$.pm.bind("chromeMsgResp",function(a){$.pm({target:b.serverTarget,url:b.baseURL,type:"chromeMsgResp",data:a})});$.pm.bind("chromeMsg",
function(a){$.pm({target:b.serverTarget,url:b.baseURL,type:"chromeMsg",data:a})});$.pm.bind("init",function(f,d){b.serverTarget=d.source;b.isLoading=!1;c.remove();a.height(f.height).attr("height",f.height+"px");return f});var d=function(a){return $('input[product="'+a+'"]')};$.pm.bind("addProduct",function(a){(new allplayers.product({uuid:a.product_uuid})).getProduct(a.product_uuid,function(b){if(b.uuid==a.product_uuid){var c=a.product_uuid,e=d(c).val();if(e)e=JSON.parse(e),e.quantity=parseInt(e.quantity),
e.quantity+=parseInt(a.quantity),d(c).val(JSON.stringify(e)),$("#add-product-display-"+c+" td:last").text(e.quantity);else if(a.product_uuid&&a.price&&a.quantity&&a.title){if("product"==b.type||"undefined"==a.price)a.price=accounting.formatMoney(b.price_raw/100);a.title=b.title;$("<input>").attr({type:"hidden",product:c,name:"add-product[]",value:JSON.stringify(a)}).appendTo("form#og-registration-register-app");$("#edit-next").val("Continue");0==$("#add-products-table").length&&($("<table>").attr({id:"add-products-table",
"class":"sticky-table"}).appendTo("#add-products"),$("#add-products-table").append("<thead><tr><th>Added Products</th><th>Price</th><th>Quantity</th></tr></thead><tbody></tbody>"));$("#add-products-table tbody").append('<tr id="add-product-display-'+c+'"><td>'+a.title+"</td><td>"+a.price+"</td><td>"+a.quantity+"</td></tr>")}}else alert("There was an error adding the product.")})});$.pm.bind("removeProduct",function(a){a=a.product_uuid;d(a).val()&&(d(a).remove(),$("#add-product-display-"+a).remove())});
$.pm.bind("clientReady",function(a,c){b.serverTarget=c.source;b.pluginReady&&$.pm({target:c.source,url:b.baseURL,type:"chromePluginReady"});"registration"==b.options.type?$.pm({target:c.source,url:b.baseURL,type:"getRegistration",data:b.options.reg}):"checkout"==b.options.type&&$.pm({target:c.source,url:b.baseURL,type:"getCheckout",data:b.options.checkout})});allplayers.app.server.prototype.init.processCheckout=function(a,c){$.pm({target:b.serverTarget,url:b.baseURL,type:"processCheckout",data:a})}};
